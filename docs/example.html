<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Content-Security-Policy" content="default-src * 'self' blob: data: gap:; style-src * 'self' 'unsafe-inline' blob: data: gap:; script-src * 'self' 'unsafe-eval' 'unsafe-inline' blob: data: gap:; object-src * 'self' blob: data: gap:; img-src * 'self' 'unsafe-inline' blob: data: gap:; connect-src * 'self' 'unsafe-inline' blob: data: gap:; frame-src * 'self' blob: data: gap:;">

  <title>Invokers.js - Interactive Cookbook</title>
  <style>
    /* --- Base Styles & Theme --- */
    :root {
      --brand-primary: #6a0dad; --brand-secondary: #4CAF50; --brand-accent: #f39c12;
      --border-color: #e0e0e0; --bg-color: #fff; --text-color: #333; --surface-color: #f9f9f9;
      --success-bg: #e8f5e9; --success-border: #a5d6a7;
    }
    html { scroll-padding-top: 2rem; scroll-behavior: smooth; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.6; color: var(--text-color); background-color: var(--bg-color); margin: 0; padding: 2rem;
    }
    main { max-width: 800px; margin: 0 auto; }
    h1, h2, h3 { color: var(--brand-primary); line-height: 1.2; }
    h1 { font-size: 2.5rem; text-align: center; margin-bottom: 0.5rem; }
    h2 { border-bottom: 2px solid var(--border-color); padding-bottom: 0.5rem; margin-top: 3.5rem; }
    h3 { margin-top: 2.5rem; color: #444; }
    p, li { color: #555; }
    code { background: #f0e6f8; color: var(--brand-primary); padding: 0.2em 0.4em; border-radius: 4px; font-family: monospace; }
    button {
      font-size: 1rem; padding: 0.6em 1.2em; border-radius: 8px; border: 1px solid var(--brand-primary);
      background-color: var(--brand-primary); color: white; cursor: pointer; transition: all 0.2s;
    }
    button:hover { background-color: #580a94; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    button:active { transform: translateY(0); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    button:disabled { background-color: #ccc; border-color: #ccc; cursor: not-allowed; transform: none; box-shadow: none; }
    .demo-box { border: 1px solid var(--border-color); padding: 1.5rem; border-radius: 8px; background: var(--surface-color); margin-top: 1rem; }
    .note { background-color: #fffbe5; border-left: 4px solid var(--brand-accent); padding: 1rem; border-radius: 4px; margin: 1.5rem 0; }

    /* Component-specific Styles */
    .dark-mode { --bg-color: #222; --text-color: #eee; --surface-color: #333; --border-color: #444; }
    .is-active { border-color: var(--brand-secondary); box-shadow: 0 0 10px rgba(76, 175, 80, 0.3); }
    [role="tablist"] button { background: #eee; border-color: #ccc; color: #555; box-shadow: none; }
    [role="tablist"] button[aria-expanded="true"] { background: var(--brand-primary); border-color: var(--brand-primary); color: white; transform: none; }
    dialog { border: 2px solid var(--brand-primary); border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); padding: 2rem; }
    form > label { display: block; font-weight: bold; margin-bottom: 0.5rem; }
    form > input { width: 100%; padding: 0.5rem; border: 1px solid var(--border-color); border-radius: 4px; box-sizing: border-box; }
    form > * + * { margin-top: 1rem; }
    #dynamic-content-area { border-style: dashed; border-color: var(--brand-accent); transition: all 0.3s; }
    .success-message { background-color: var(--success-bg); border: 1px solid var(--success-border); color: #1b5e20; text-align: center; }

    /* Enhanced chaining demo styles */
    .processing { background-color: #fff3cd; border-color: #ffeaa7; }
    .success { background-color: var(--success-bg); border-color: var(--success-border); color: #1b5e20; }
    .error { background-color: #f8d7da; border-color: #f5c6cb; color: #721c24; }
    .primary { background-color: #e3f2fd; border-color: #2196f3; }
    .secondary { background-color: #f3e5f5; border-color: #9c27b0; }
    .tutorial-active { box-shadow: 0 0 15px rgba(106, 13, 173, 0.5); transform: scale(1.02); }

    /* View Transition API Support */
    @keyframes fade-in { from { opacity: 0; } }
    @keyframes fade-out { to { opacity: 0; } }
    ::view-transition-old(root) { animation: 180ms cubic-bezier(0.4, 0, 1, 1) both fade-out; }
    ::view-transition-new(root) { animation: 300ms cubic-bezier(0, 0, 0.2, 1) both fade-in; }
  </style>
</head>
<body id="page-body">

  <main>
    <h1>Invokers.js Interactive Cookbook</h1>
    <p style="text-align: center;">A comprehensive showcase of declarative UI patterns, command chaining, and workflow orchestration using the future of HTML. Open your console to see helpful warnings!</p>

    <!-- =================================================================== -->
    <h2 id="live-demo">Live Demo: Infinite Swaps & Forms</h2>
    <!-- =================================================================== -->
    <p>This is the best way to understand Invokers. Click the button below to start a multi-step flow that demonstrates content swapping, form submission, and chained invokers, all without a single page reload.</p>
    <div id="dynamic-content-area" class="demo-box">
      <!-- The content inside this div will be dynamically replaced -->
      <p>This is the initial state. The button below will replace this content with the first step.</p>
    </div>
    <p style="text-align: center; margin-top: 1rem;">
      <button type="button" command="--dom:swap" commandfor="dynamic-content-area" data-template-id="step-1-template">
        Begin Demo
      </button>
    </p>

    <!-- =================================================================== -->
    <h2 id="foundations">Part 1: Foundational Concepts</h2>
    <!-- =================================================================== -->
    <p>These examples cover the core building blocks of declarative UI.</p>

    <h3>Native Commands: Controlling a <code>&lt;dialog&gt;</code></h3>
    <div class="demo-box">
      <button type="button" command="show-modal" commandfor="my-dialog">Open Dialog</button>
      <dialog id="my-dialog">
        <h3>Modal Dialog</h3>
        <p>This dialog was opened declaratively. The library's polyfill ensures this works in all modern browsers.</p>
        <button type="button" command="close" commandfor="my-dialog">Close</button>
      </dialog>
    </div>

    <h3><code>--toggle</code>: Accordions & Disclosures</h3>
    <div class="demo-box">
      <button type="button" command="--toggle" commandfor="faq-1" aria-expanded="false">
        <strong>What does `commandfor` do?</strong>
      </button>
      <div id="faq-1" hidden>
        <p>It's the standard attribute from the W3C/WHATWG proposal that links an invoker button to its target element via the target's ID.</p>
      </div>
    </div>
    
    <h3><code>--show</code>: Accessible Tab Panels</h3>
    <div class="demo-box">
      <div role="tablist" aria-label="Feature Tabs">
        <button type="button" command="--show" commandfor="panel-1" aria-expanded="true">Tab 1</button>
        <button type="button" command="--show" commandfor="panel-2" aria-expanded="false">Tab 2</button>
      </div>
      <div style="padding-top: 1rem;">
        <div role="tabpanel" id="panel-1">Content for the first tab panel.</div>
        <div role="tabpanel" id="panel-2" hidden>Content for the second tab panel.</div>
      </div>
    </div>

    <h3><code>interestfor</code>: Hover Tooltips & Popovers</h3>
    <div class="demo-box">
      <p>Hover over these buttons to see interest invokers in action. They use the <code>interestfor</code> attribute to link to popover targets.</p>
      <button type="button" interestfor="tooltip-1">Hover for hint</button>
      <div id="tooltip-1" popover="hint">This is a simple hint tooltip!</div>
      <button type="button" interestfor="tooltip-2" style="margin-left: 1rem;">Hover for rich content</button>
      <div id="tooltip-2" popover="auto">
        <h4>Rich Tooltip</h4>
        <p>This tooltip can contain rich HTML content, including headings, paragraphs, and even images.</p>
      </div>
    </div>

    <!-- =================================================================== -->
    <h2 id="advanced">Part 2: Advanced Techniques</h2>
    <!-- =================================================================== -->
    
    <h3>Extending Invokers with Custom JavaScript</h3>
    <div class="demo-box">
      <p>This button uses a custom <code>--log</code> command registered in the script block below. Open your console to see the output!</p>
      <button type="button" command="--log:info:Hello from a custom command!" commandfor="page-body">Run Custom 'log' Command</button>
    </div>

    <div class="note">
      <p><strong>Upgrading from v0.x?</strong> The old pattern <code>&lt;button command="toggle" aria-controls="menu"&gt;</code> should be updated to the new, standard pattern: <code>&lt;button type="button" command="--toggle" commandfor="menu"&gt;</code>. The library will try to handle old markup and warn you in the console, but updating is highly recommended!</p>
    </div>

    <!-- =================================================================== -->
    <h2 id="core-commands">Part 3: Core DOM Commands</h2>
    <!-- =================================================================== -->
    <p>The core library includes powerful commands for text and attribute manipulation, using a clean, colon-delimited syntax.</p>

    <h3><code>--attr</code>: Manipulating Attributes</h3>
    <div class="demo-box">
      <fieldset id="user-fieldset" disabled>
        <legend>User Profile</legend>
        <label for="username">Username:</label>
        <input id="username" type="text" value="prefilled-username" aria-invalid="false">
      </fieldset>

      <p style="margin-top: 1rem;">
        <button type="button" command="--attr:remove:disabled" commandfor="user-fieldset">
          Enable Fields
        </button>
        <button type="button" command="--attr:set:aria-invalid:true" commandfor="username">
          Mark as Invalid
        </button>
        <button type="button" command="--attr:set:disabled:true" commandfor="user-fieldset">
          Reset (Disable)
        </button>
      </p>

      <style>
        #username[aria-invalid="true"] { border-color: tomato; box-shadow: 0 0 5px rgba(255, 99, 71, 0.5); }
      </style>
    </div>

    <h3><code>--text</code>: Updating Text Content</h3>
    <div class="demo-box">
      <div id="status-message" role="status" style="padding: 1rem; border: 1px solid var(--border-color); border-radius: 4px; min-height: 2.5rem; text-align: center;">
        <!-- This is the target for text updates -->
      </div>
      <p style="margin-top: 1rem;">
        <button type="button" command="--text:set:âœ… Profile saved successfully!" commandfor="status-message">
          Show Success
        </button>
        <button type="button" command="--text:append: (processing...)" commandfor="status-message">
          Append Status
        </button>
        <button type="button" command="--text:prepend:URGENT: " commandfor="status-message">
          Prepend Status
        </button>
        <button type="button" command="--text:clear" commandfor="status-message">
          Clear
        </button>
      </p>
    </div>

    <!-- =================================================================== -->
    <h2 id="chaining">Part 4: Universal Command Chaining</h2>
    <!-- =================================================================== -->
    <p>The <code>data-and-then</code> attribute allows you to chain commands together, creating powerful sequences. This works for <strong>all</strong> commands, both synchronous and asynchronous.</p>

    <h3>Chaining Synchronous Commands</h3>
    <div class="demo-box">
        <div id="sync-chain-target" style="padding: 1rem; border: 2px dashed var(--border-color); border-radius: 4px; transition: all 0.3s;">
            Initial State
        </div>
        <p style="margin-top: 1rem;">
            This button will first add a highlight class, and then immediately update the text content.
        </p>
        <button type="button"
            command="--class:add:is-active"
            commandfor="sync-chain-target"
            data-and-then="--text:set:âœ… Highlighted and Updated!">
            Run Synchronous Chain
        </button>
    </div>

    <h3>Chaining After Asynchronous Commands (e.g., Fetch)</h3>
    <div class="demo-box">
        <p>This button will fetch content and, only upon successful completion, run a second command to add a 'loaded' class, triggering a CSS animation.</p>
        <div id="async-chain-target" class="content-box"></div>
        <button type="button"
            command="--fetch:get"
            commandfor="async-chain-target"
            data-url="/api/posts/2"
            data-loading-template="spinner-template"
            data-and-then="--class:add:loaded">
            Fetch and Animate on Complete
        </button>
        <style> .content-box.loaded { animation: fadeIn 0.5s ease-out; } </style>
    </div>
    
    <h3>Target Override for Chained Commands</h3>
    <div class="demo-box">
        <div id="primary-target" style="padding: 1rem; border: 2px solid var(--border-color); border-radius: 4px;">Primary Target</div>
        <div id="secondary-target" style="padding: 1rem; border: 2px solid var(--border-color); border-radius: 4px; margin-top: 1rem;">Secondary Target</div>
        <p style="margin-top: 1rem;">This button affects the primary target, but the chained command affects the secondary target using <code>data-then-target</code>.</p>
        <button type="button"
            command="--text:set:Primary updated!"
            commandfor="primary-target"
            data-and-then="--text:set:Secondary updated via chain!"
            data-then-target="secondary-target">
            Chain to Different Target
        </button>
    </div>

    <!-- =================================================================== -->
    <h2 id="enhanced-chaining">Part 5: Enhanced & Conditional Chaining</h2>
    <!-- =================================================================== -->

    <h3>Conditional Chaining (Success/Error)</h3>
    <div class="demo-box">
        <div id="conditional-target" style="padding: 1rem; border: 2px solid var(--border-color); border-radius: 4px;">Status: Ready</div>
        <p style="margin-top: 1rem;">These buttons simulate success and failure, triggering different follow-up commands.</p>
        <button type="button"
            command="--fetch:get"
            commandfor="conditional-target"
            data-url="/api/posts/1"
            data-loading-template="spinner-template"
            data-after-success="--class:add:success,--text:append: âœ…"
            data-after-error="--class:add:error,--text:append: âŒ">
            Simulate Success
        </button>
        <button type="button"
            command="--fetch:get"
            commandfor="conditional-target"
            data-url="/api/this-will-fail"
            data-loading-template="spinner-template"
            data-after-success="--class:add:success,--text:append: âœ…"
            data-after-error="--class:add:error,--text:append: âŒ">
            Simulate Error
        </button>
        <button type="button" command="--class:remove:success,error" commandfor="conditional-target" data-and-then="--text:set:Status: Ready">Reset</button>
    </div>

    <h3>Command Lifecycle States</h3>
    <div class="demo-box">
        <div id="lifecycle-target" style="padding: 1rem; border: 2px solid var(--border-color); border-radius: 4px;">Click the buttons below.</div>
        <p style="margin-top: 1rem;">
            <button type="button" command="--text:set:ðŸŽ‰ This button only works once!" commandfor="lifecycle-target" data-state="once">
                One-Time Button
            </button>
            <button type="button" command="--text:append: (disabled)" commandfor="lifecycle-target" data-state="disabled">
                Disabled Button
            </button>
            <button type="button" command="--text:clear" commandfor="lifecycle-target">
                Reset Target
            </button>
        </p>
    </div>

    <!-- =================================================================== -->
    <h2 id="declarative-andthen">Part 6: Declarative &lt;and-then&gt; Elements</h2>
    <!-- =================================================================== -->
    <p>Create visual, tree-structured command chains using declarative <code>&lt;and-then&gt;</code> elements.</p>

    <h3>Nested Chaining with Delays</h3>
    <div class="demo-box">
        <div id="andthen-basic-target" style="padding: 1rem; border: 2px solid var(--border-color); border-radius: 4px;">Ready for multi-step process</div>
        <p style="margin-top: 1rem;">This button creates a complex, multi-step workflow using nested <code>&lt;and-then&gt;</code> elements:</p>
        <button type="button" id="start-multistep-button" command="--text:set:Step 1: Started" commandfor="andthen-basic-target">
            Start Multi-Step Process
            <and-then command="--class:add:processing" data-delay="500">
                <and-then command="--text:append: â†’ Step 2: Processing..." data-delay="800">
                    <and-then command="--class:remove:processing" data-delay="500">
                        <and-then command="--class:add:success">
                            <and-then command="--text:append: â†’ Step 3: Complete!">
                            </and-then>
                        </and-then>
                    </and-then>
                </and-then>
            </and-then>
        </button>
        <button type="button" command="--text:set:Ready for multi-step process" commandfor="andthen-basic-target" data-and-then="--class:remove:processing,success,--and-then:reset:start-multistep-button">
            Reset Demo
        </button>
    </div>

    <h3>Conditional Execution with &lt;and-then&gt;</h3>
    <div class="demo-box">
        <div id="andthen-status" style="padding: 0.5rem; background: #f9f9f9; border-radius: 4px;">Status: Ready</div>
        <p style="margin-top: 1rem;">This button simulates a successful fetch and uses <code>data-condition</code> to execute only the success path.</p>
        <button type="button" command="--fetch:get" commandfor="andthen-status" data-url="/api/posts/3" data-loading-template="spinner-template">
            Simulate Successful Operation
            <and-then command="--text:set:âœ… Success path executed!" commandfor="andthen-status" data-condition="success" data-delay="500"></and-then>
            <and-then command="--text:set:âŒ Error path executed!" commandfor="andthen-status" data-condition="error"></and-then>
        </button>
    </div>
  </main>

  <!-- =================================================================== -->
  <!-- TEMPLATES for the Live Demo & Other Examples -->
  <!-- =================================================================== -->
  <template id="step-1-template">
    <h3>Step 1: Content Loaded</h3>
    <p>This content was swapped in from a <code>&lt;template&gt;</code> tag. The button below is a *new* invoker that was just added. It will work immediately.</p>
    <button type="button" command="--dom:swap" commandfor="dynamic-content-area" data-template-id="step-2-form-template">
      Load Contact Form &rarr;
    </button>
  </template>

  <template id="step-2-form-template">
    <h3>Step 2: A Form Loaded via Fetch</h3>
    <p>This form will be "submitted" using <code>--fetch:send</code>. We'll simulate a successful server response.</p>
    <form id="contact-form" action="/api/contact" method="post">
      <label for="name">Name:</label>
      <input type="text" id="name" name="name" value="Jane Doe" required>
      <label for="email">Email:</label>
      <input type="email" id="email" name="email" value="jane.doe@example.com" required>
       <button type="button" command="--fetch:send" commandfor="contact-form" data-response-target="#dynamic-content-area" data-loading-template="spinner-template">
         Submit Form
       </button>
    </form>
  </template>

  <template id="form-success-template">
    <div class="success-message">
      <h3>Step 3: Success!</h3>
      <p>The form was "submitted" and the server returned this success message. This demonstrates a complete, interactive loop.</p>
      <button type="button" command="--dom:swap" commandfor="dynamic-content-area" data-template-id="step-1-template">
        Start Over
      </button>
    </div>
  </template>

  <template id="spinner-template">
    <div style="display: flex; align-items: center; justify-content: center; color: #888; padding: 1rem;">
      <svg width="24" height="24" viewBox="0 0 24 24" style="margin-right: 0.5rem;" fill="currentColor"><path d="M12,4a8,8,0,0,1,7.89,6.7A1.53,1.53,0,0,0,21.38,12h0a1.5,1.5,0,0,0,1.48-1.75,11,11,0,0,0-21.72,0A1.5,1.5,0,0,0,2.62,12h0a1.53,1.53,0,0,0,1.49-1.3A8,8,0,0,1,12,4Z"><animateTransform attributeName="transform" type="rotate" from="0 12 12" to="360 12 12" dur="1s" repeatCount="indefinite"/></path></svg>
      Loading...
    </div>
  </template>
  <template id="error-template">
    <p style="color: tomato; font-weight: bold;">Oops! Something went wrong.</p>
  </template>

  <!-- =================================================================== -->
  <!-- SCRIPT SETUP -->
  <!-- =================================================================== -->
  <script type="module">
    // Using a CDN for simplicity, but you can install via npm: npm install invokers
    // import 'https://esm.sh/invokers';

    import '../dist/esm/development/compatible.js';
    import '../dist/esm/development/interest.js';

    if (window.Invoker?.debug) {
      console.log("âœ… Invokers Core, All Commands, and Interest Invokers loaded and ready!");
    }

    // (Advanced) Register a project-specific command.
    if (window.Invoker) {
      window.Invoker.debug = true; // Enable detailed console logs
      const customLogger = ({ invoker, params }) => {
        const [level, ...messageParts] = params;
        const message = messageParts.join(':');
        console[level === 'warn' || level === 'error' ? level : 'info'](
            `[Custom Logger]: ${message}`, { triggeredBy: invoker }
        );
      };
      window.Invoker.register('log', customLogger);
    }

    // DEMO HELPER: Fake fetch responses with simulated delays
    const nativeFetch = window.fetch;
    window.fetch = async (url, options) => {
      let urlString;
      if (typeof url === 'string') {
        urlString = url;
      } else if (url instanceof URL) {
        urlString = url.pathname;
      } else {
        urlString = url.toString();
      }

      // Handle both relative URLs and full URLs
      const path = urlString.startsWith('http') ? new URL(urlString).pathname : urlString;

      if (path.startsWith('/api/')) {
        console.log(`DEMO: Intercepting fetch for "${path}"`);
        return new Promise((resolve) => {
          setTimeout(() => {
            if (path === '/api/this-will-fail') {
              resolve(new Response('Not Found', { status: 404, statusText: 'Not Found' }));
            } else if (path === '/api/contact') {
              // For form submission, return the success template content
              const successTemplate = document.getElementById('form-success-template');
              const htmlResponse = successTemplate ? successTemplate.innerHTML : '<p>Success!</p>';
              resolve(new Response(htmlResponse, { headers: { 'Content-Type': 'text/html' } }));
            } else {
              // For other API calls, return dummy success response
              const responseData = { title: 'Fetch Success!', body: 'This content was loaded from a simulated API.' };
              const htmlResponse = `<h3>${responseData.title}</h3><p>${responseData.body}</p>`;
              resolve(new Response(htmlResponse, { headers: { 'Content-Type': 'text/html' } }));
            }
          }, 1000); // Simulate network delay
        });
      }
      return nativeFetch(url, options);
    };
  </script>

</body>
</html>