"use strict";var re=Object.defineProperty;var Ue=Object.getOwnPropertyDescriptor;var qe=Object.getOwnPropertyNames;var _e=Object.prototype.hasOwnProperty;var je=(a,e)=>{for(var t in e)re(a,t,{get:e[t],enumerable:!0})},Be=(a,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of qe(e))!_e.call(a,r)&&r!==t&&re(a,r,{get:()=>e[r],enumerable:!(n=Ue(e,r))||n.enumerable});return a};var We=a=>Be(re({},"__esModule",{value:!0}),a);var rt={};je(rt,{demoCommands:()=>te,registerDemoCommands:()=>nt});module.exports=We(rt);function Ve(){let a=typeof window!="undefined"?window:globalThis;return typeof HTMLButtonElement!="undefined"&&"command"in HTMLButtonElement.prototype&&"source"in((a.CommandEvent||{}).prototype||{})}function we(a,e,t=!0){Object.defineProperty(a,e,{...Object.getOwnPropertyDescriptor(a,e),enumerable:t})}function F(a){return a&&typeof a.getRootNode=="function"?a.getRootNode():a&&a.parentNode?F(a.parentNode):a}var ae=new WeakMap,oe=new WeakMap,P=class extends Event{constructor(e,t={}){super(e,t);let{source:n,command:r}=t;if(n!=null&&!(n instanceof Element))throw new TypeError("source must be an element");ae.set(this,n||null),oe.set(this,r!==void 0?String(r):"")}get[Symbol.toStringTag](){return"CommandEvent"}get source(){if(!ae.has(this))throw new TypeError("illegal invocation");let e=ae.get(this);if(!(e instanceof Element))return null;let t=F(e);return t!==F(this.target||document)?t instanceof ShadowRoot?t.host:null:e}get command(){if(!oe.has(this))throw new TypeError("illegal invocation");return oe.get(this)||""}get action(){throw new Error("CommandEvent#action was renamed to CommandEvent#command")}get invoker(){throw new Error("CommandEvent#invoker was renamed to CommandEvent#source")}};we(P.prototype,"source");we(P.prototype,"command");var ie=class extends Event{constructor(e,t={}){throw super(e,t),new Error("InvokeEvent has been deprecated, it has been renamed to `CommandEvent`")}},q=new WeakMap;function se(a){Object.defineProperties(a.prototype,{commandForElement:{enumerable:!0,configurable:!0,set(e){if(this.hasAttribute("invokeaction"))throw new TypeError("Element has deprecated `invokeaction` attribute, replace with `command`");if(this.hasAttribute("invoketarget"))throw new TypeError("Element has deprecated `invoketarget` attribute, replace with `commandfor`");if(e===null)this.removeAttribute("commandfor"),q.delete(this);else if(e instanceof Element){this.setAttribute("commandfor",e.id||"");let t=F(e);F(this)===t||t===this.ownerDocument?q.set(this,e):q.delete(this)}else throw new TypeError("commandForElement must be an element or null")},get(){if(this.localName!=="button"&&this.localName!=="input"&&this.localName!=="textarea")return null;if(this.hasAttribute("invokeaction")||this.hasAttribute("invoketarget"))return console.warn("Element has deprecated `invoketarget` or `invokeaction` attribute, use `commandfor` and `command` instead"),null;if(this.disabled)return null;if(this.form&&this.getAttribute("type")!=="button")return console.warn("Element with `commandfor` is a form participant. It should explicitly set `type=button` in order for `commandfor` to work"),null;let e=q.get(this);if(e)return e.isConnected?e:(q.delete(this),null);let t=F(this),n=this.getAttribute("commandfor");return(t instanceof Document||t instanceof ShadowRoot)&&n&&t.getElementById(n)||null}},command:{enumerable:!0,configurable:!0,get(){let e=this.getAttribute("command")||"";if(e.startsWith("--"))return e;let t=e.toLowerCase();switch(t){case"show-modal":case"close":case"request-close":case"toggle-popover":case"hide-popover":case"show-popover":case"toggle-openable":case"close-openable":case"open-openable":case"toggle":case"open":case"show-picker":case"play-pause":case"pause":case"play":case"toggle-muted":case"toggle-fullscreen":case"request-fullscreen":case"exit-fullscreen":case"copy-text":case"share":case"step-up":case"step-down":return t}return""},set(e){this.setAttribute("command",e)}},invokeAction:{enumerable:!1,configurable:!0,get(){throw new Error("invokeAction is deprecated. It has been renamed to command")},set(e){throw new Error("invokeAction is deprecated. It has been renamed to command")}},invokeTargetElement:{enumerable:!1,configurable:!0,get(){throw new Error("invokeTargetElement is deprecated. It has been renamed to command")},set(e){throw new Error("invokeTargetElement is deprecated. It has been renamed to command")}}})}var _=new WeakMap;Object.defineProperties(HTMLElement.prototype,{oncommand:{enumerable:!0,configurable:!0,get(){return ce.takeRecords(),_.get(this)||null},set(a){let e=_.get(this)||null;e&&this.removeEventListener("command",e),typeof a=="object"||typeof a=="function"?a!==null?_.set(this,a):_.delete(this):_.delete(this),typeof a=="function"&&this.addEventListener("command",a)}}});function j(a){for(let e of a){if(typeof Element!="undefined"&&!(e instanceof Element))continue;let t=e.getAttribute("oncommand");if(t!==null&&e.oncommand!==null)try{e.oncommand=new Function("event",t)}catch(n){console.error("Invokers Polyfill: Error parsing oncommand attribute for element:",e,n)}}}var ce=new MutationObserver(a=>{for(let e of a){let{target:t}=e;e.type==="childList"?(typeof Element!="undefined"&&t instanceof Element||t&&typeof t.querySelectorAll=="function")&&j(Array.from(t.querySelectorAll("[oncommand]"))):t instanceof HTMLElement&&t.hasAttribute("oncommand")?j([t]):t instanceof HTMLElement&&(t.oncommand=null)}});function Je(a){var s,i,c,d,m,f;if(a.defaultPrevented||a.type!=="click")return;let e=a.target.closest("button[invoketarget], button[invokeaction], input[invoketarget], input[invokeaction]");if(e&&(console.warn("Invokers Polyfill: Elements with `invoketarget` or `invokeaction` are deprecated and should be renamed to use `commandfor` and `command` respectively"),e.matches("input")))throw new Error("Input elements no longer support `commandfor`");let t=a.target.closest("button[commandfor][command]");if(!t)return;if(t.form&&t.getAttribute("type")!=="button"){a.preventDefault(),console.error("Invokers Polyfill: Element with `commandfor` is a form participant. It should explicitly set `type=button` in order for `commandfor` to work. To act as a Submit/Reset button, it must not have command or commandfor attributes.",t);return}if(t.hasAttribute("command")!==t.hasAttribute("commandfor")){let u=t.hasAttribute("command")?"command":"commandfor",h=t.hasAttribute("command")?"commandfor":"command";console.error(`Invokers Polyfill: Element with ${u} attribute must also have a ${h} attribute to function.`,t);return}if(t.command===""){console.warn(`Invokers Polyfill: "${t.getAttribute("command")}" is not a valid command value for element:`,t,"Custom commands must begin with --");return}let n=t.commandForElement;if(!n){console.warn("Invokers Polyfill: commandfor target not found for invoker:",t);return}let r=new P("command",{command:t.command,source:t,cancelable:!0,bubbles:!0,composed:!0});if(n.dispatchEvent(r),r.defaultPrevented)return;let o=r.command.toLowerCase();if(n.matches("[popover]")){let u=n.matches(":popover-open");o==="toggle-popover"?(s=n[u?"hidePopover":"showPopover"])==null||s.call(n,{source:t}):o==="hide-popover"&&u?n.hidePopover():o==="show-popover"&&!u&&((i=n.showPopover)==null||i.call(n,{source:t}))}if(n.localName==="dialog"){let u=n.hasAttribute("open");if(o==="show-modal"&&!u)n.showModal();else if(o==="close"&&u)n.close(t.value);else if(o==="request-close"&&u){let h=new Event("cancel",{cancelable:!0});n.dispatchEvent(h),h.defaultPrevented||n.close(t.value)}}if(n.localName==="details"){let u=n.open;o==="toggle"?n.open=!u:o==="open"&&!u?n.open=!0:o==="close"&&u&&(n.open=!1)}if(o.includes("openable")&&typeof n.toggleOpenable=="function"&&(o==="toggle-openable"?n.toggleOpenable():o==="open-openable"?(c=n.openOpenable)==null||c.call(n):o==="close-openable"&&((d=n.closeOpenable)==null||d.call(n))),(n.localName==="select"||n.localName==="input")&&o==="show-picker")try{typeof n.showPicker=="function"&&document.hasFocus()&&t.ownerDocument.hasFocus()&&n.showPicker()}catch(u){console.warn("Invokers: showPicker failed:",u)}if(n.localName==="video"||n.localName==="audio"){let u=n;o==="play-pause"?u.paused?u.play().catch(()=>{}):u.pause():o==="play"&&u.paused?u.play().catch(()=>{}):o==="pause"&&!u.paused?u.pause():o==="toggle-muted"&&(u.muted=!u.muted)}if(o.includes("fullscreen"))try{o==="toggle-fullscreen"?document.fullscreenElement===n?document.exitFullscreen():(m=n.requestFullscreen)==null||m.call(n):o==="request-fullscreen"&&document.fullscreenElement!==n?(f=n.requestFullscreen)==null||f.call(n):o==="exit-fullscreen"&&document.fullscreenElement===n&&document.exitFullscreen()}catch(u){console.warn("Invokers: Fullscreen operation failed:",u)}if(o==="copy-text")try{let u="";if(n===t?u=t.value||t.textContent||"":u=n.textContent||"",navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(u.trim());else{let h=document.createElement("textarea");h.value=u.trim(),h.style.position="fixed",h.style.opacity="0",document.body.appendChild(h),h.select(),document.execCommand("copy"),document.body.removeChild(h)}}catch(u){console.warn("Invokers: Copy operation failed:",u)}if(o==="share")try{let u="";if(n===t?u=t.value||t.textContent||"":u=n.textContent||"",navigator.share){let h=u.trim();h.startsWith("http://")||h.startsWith("https://")?navigator.share({url:h}):navigator.share({text:h})}}catch(u){console.warn("Invokers: Share operation failed:",u)}if(n.localName==="input"&&n.type==="number"){let u=n;try{o==="step-up"?u.stepUp():o==="step-down"&&u.stepDown()}catch(h){console.warn("Invokers: Step operation failed:",h)}}}function Ee(a){a.addEventListener("click",Je,!0)}function Ge(a,e){let t=a.prototype.attachShadow;a.prototype.attachShadow=function(r){let o=t.call(this,r);return e(o),o};let n=a.prototype.attachInternals;a.prototype.attachInternals=function(){let r=n.call(this);return r.shadowRoot&&e(r.shadowRoot),r}}function ze(){let a=typeof window!="undefined"?window:globalThis;Ve()||a.CommandEvent!==P&&(document.addEventListener("invoke",e=>{e.type==="invoke"&&e.isTrusted&&(e.stopImmediatePropagation(),e.preventDefault())},!0),document.addEventListener("command",e=>{e.type==="command"&&e.isTrusted&&!e.defaultPrevented&&e.eventPhase===Event.AT_TARGET&&(e.stopImmediatePropagation(),e.preventDefault())},!0),se(HTMLButtonElement),se(HTMLInputElement),se(HTMLTextAreaElement),Ge(HTMLElement,e=>{Ee(e),ce.observe(e,{subtree:!0,childList:!0,attributeFilter:["oncommand"]}),j(Array.from(e.querySelectorAll("[oncommand]")))}),Ee(document),ce.observe(document,{subtree:!0,childList:!0,attributeFilter:["oncommand"]}),j(Array.from(document.querySelectorAll("[oncommand]"))),typeof a.CommandEvent=="undefined"?Object.defineProperty(a,"CommandEvent",{value:P,configurable:!0,writable:!0,enumerable:!1}):console.warn("Invokers Polyfill: `CommandEvent` already exists. The polyfill's CommandEvent will not overwrite it."),typeof a.InvokeEvent=="undefined"&&Object.defineProperty(a,"InvokeEvent",{value:ie,configurable:!0,writable:!0,enumerable:!1}))}ze();var Ke=[[1,/^[0-9]+(\.[0-9]+)?(?:[eE][+-]?[0-9]+)?/],[2,/^'(?:[^'\\]|\\.)*'|^"(?:[^"\\]|\\.)*"/],[5,/^(true|false)\b/],[6,/^null\b/],[0,/^[a-zA-Z_$][a-zA-Z0-9_$]*/],[3,/^(===|!==|==|!=|<=|>=|&&|\|\||[<>\+\-\*\/%?!])/],[4,/^\./],[7,/^\(/],[8,/^\)/],[9,/^\[/],[10,/^\]/],[11,/^:/]],O=class O{tokenize(e){if(typeof e!="string")throw new Error("Invokers Expression Error: Expression must be a string");if(e.length>O.MAX_EXPRESSION_LENGTH)throw new Error(`Invokers Expression Error: Expression too long (max ${O.MAX_EXPRESSION_LENGTH} characters)`);if(e.includes("\0")||e.includes("\u2028")||e.includes("\u2029"))throw new Error("Invokers Expression Error: Expression contains invalid characters");let t=[/eval\s*\(/i,/Function\s*\(/i,/setTimeout\s*\(/i,/setInterval\s*\(/i,/XMLHttpRequest/i,/fetch\s*\(/i,/import\s*\(/i,/require\s*\(/i,/process\./i,/globalThis\./i,/window\./i,/document\./i,/console\./i,/alert\s*\(/i,/prompt\s*\(/i,/confirm\s*\(/i];for(let o of t)if(o.test(e))throw new Error("Invokers Expression Error: Expression contains potentially unsafe operations");let n=[],r=0;for(;r<e.length;){if(n.length>=O.MAX_TOKEN_COUNT)throw new Error(`Invokers Expression Error: Expression too complex (max ${O.MAX_TOKEN_COUNT} tokens)`);if(/\s/.test(e[r])){r++;continue}let o=!1;for(let[s,i]of Ke){let c=e.substring(r).match(i);if(c){if(s===0){let d=c[0];if(this.isDangerousIdentifier(d))throw new Error(`Invokers Expression Error: Access to '${d}' is not allowed`)}n.push({type:s,value:c[0],position:r}),r+=c[0].length,o=!0;break}}if(!o){let s=e[r],i=Math.max(0,r-10),c=Math.min(e.length,r+10),d=e.substring(i,c),m=" ".repeat(r-i)+"^";throw new Error(`Invokers Expression Error: Unexpected character '${s}' at position ${r}
${d}
${m}`)}}return n.push({type:12,value:"",position:r}),n}isDangerousIdentifier(e){return["globalThis","global","self","document","navigator","location","history","localStorage","sessionStorage","indexedDB","cookies","XMLHttpRequest","fetch","WebSocket","process","Buffer","require","module","exports","__dirname","__filename","eval","Function","setTimeout","setInterval","clearTimeout","clearInterval","alert","prompt","confirm","console","debugger","prototype","constructor","innerHTML","outerHTML","innerText","insertAdjacentHTML"].includes(e)||e.startsWith("__")||e.includes("script")||e.includes("javascript")||e.includes("vbscript")}};O.MAX_EXPRESSION_LENGTH=1e4,O.MAX_TOKEN_COUNT=1e3;var G=O;var z=class{constructor(e){this.current=0;this.tokens=e}parse(){let e=this.expression();if(!this.isAtEnd()){let t=this.peek();throw new Error(`Invokers Expression Error: Unexpected token '${t.value}' at position ${t.position}. Expected end of expression.`)}return e}expression(){return this.conditional()}conditional(){let e=this.logicalOr();if(this.match(3,"?")){let t=e,n=this.expression();this.consume(11,"Expected ':' after '?' in conditional expression");let r=this.conditional();return{type:"CONDITIONAL",test:t,consequent:n,alternate:r}}return e}logicalOr(){let e=this.logicalAnd();for(;this.match(3,"||");){let t="||",n=this.logicalAnd();e={type:"BINARY_OP",left:e,operator:t,right:n}}return e}logicalAnd(){let e=this.equality();for(;this.match(3,"&&");){let t="&&",n=this.equality();e={type:"BINARY_OP",left:e,operator:t,right:n}}return e}equality(){let e=this.comparison();for(;this.match(3,"===","!==","==","!=");){let t=this.previous().value,n=this.comparison();e={type:"BINARY_OP",left:e,operator:t,right:n}}return e}comparison(){let e=this.term();for(;this.match(3,"<",">","<=",">=");){let t=this.previous().value,n=this.term();e={type:"BINARY_OP",left:e,operator:t,right:n}}return e}term(){let e=this.factor();for(;this.match(3,"+","-");){let t=this.previous().value,n=this.factor();e={type:"BINARY_OP",left:e,operator:t,right:n}}return e}factor(){let e=this.unary();for(;this.match(3,"*","/","%");){let t=this.previous().value,n=this.unary();e={type:"BINARY_OP",left:e,operator:t,right:n}}return e}unary(){if(this.match(3,"!","-")){let e=this.previous().value,t=this.unary();return{type:"UNARY_OP",operator:e,right:t}}return this.memberAccess()}memberAccess(){let e=this.primary();for(;;)if(this.match(4)){let t=this.consume(0,"Expected property name after '.'").value;e={type:"MEMBER_ACCESS",object:e,property:t}}else if(this.match(9)){let t=this.expression();this.consume(10,"Expected ']' after array index"),e={type:"ARRAY_ACCESS",object:e,index:t}}else break;return e}primary(){if(this.match(1))return{type:"LITERAL",value:parseFloat(this.previous().value)};if(this.match(2))return{type:"LITERAL",value:this.previous().value.slice(1,-1)};if(this.match(5))return{type:"LITERAL",value:this.previous().value==="true"};if(this.match(6))return{type:"LITERAL",value:null};if(this.match(0))return{type:"IDENTIFIER",value:this.previous().value};if(this.match(7)){let e=this.expression();return this.consume(8,"Expected ')' after expression"),e}throw new Error(`Invokers Expression Error: Unexpected token at position ${this.peek().position}: '${this.peek().value}'`)}match(e,...t){if(Array.isArray(e)){for(let n of e)if(this.check(n))return this.advance(),!0;return!1}else return this.check(e)&&(t.length===0||t.includes(this.peek().value))?(this.advance(),!0):!1}consume(e,t){if(this.check(e))return this.advance();throw new Error(`Invokers Expression Error: ${t}. Found '${this.peek().value}' at position ${this.peek().position}`)}check(e){return this.isAtEnd()?!1:this.peek().type===e}advance(){return this.isAtEnd()||this.current++,this.previous()}isAtEnd(){return this.peek().type===12}peek(){return this.tokens[this.current]}previous(){return this.tokens[this.current-1]}};var Y=class Y{constructor(e){this.recursionDepth=0;this.context=this.sanitizeContext(e)}sanitizeContext(e){let t={};for(let[n,r]of Object.entries(e))this.isSafeProperty(n)&&(t[n]=this.sanitizeValue(r));return t}sanitizeValue(e){if(e==null)return e;if(typeof e!="function")return Array.isArray(e)?e.slice(0,1e3):typeof e=="object"&&e!==null?e.constructor!==Object&&!Array.isArray(e)?this.createSafeDOMObject(e):this.sanitizeObject(e,0):e}sanitizeObject(e,t){if(t>50)return{};let n={},r=0;for(let[o,s]of Object.entries(e)){if(r>=50)break;this.isSafeProperty(o)&&(n[o]=this.sanitizeValue(s),r++)}return n}isSafeProperty(e){return!e.startsWith("__")&&!["prototype","constructor","__proto__","window","document","eval","Function"].includes(e)&&e.length<=50}createSafeDOMObject(e){return new Proxy(e,{get:(t,n)=>{if(typeof n=="string"&&this.isSafeProperty(n)){let r=t[n];return typeof r=="function"?void 0:typeof r!="object"||r===null?r:this.sanitizeValue(r)}},set:()=>!1,has:(t,n)=>typeof n=="string"&&this.isSafeProperty(n)&&n in t})}evaluate(e){if(this.recursionDepth>Y.MAX_RECURSION_DEPTH)throw new Error("Invokers Expression Error: Maximum recursion depth exceeded");this.recursionDepth++;try{switch(e.type){case"LITERAL":return e.value;case"IDENTIFIER":return this.resolveIdentifier(e.value);case"BINARY_OP":return this.evaluateBinaryOp(e);case"UNARY_OP":return this.evaluateUnaryOp(e);case"MEMBER_ACCESS":return this.evaluateMemberAccess(e);case"ARRAY_ACCESS":return this.evaluateArrayAccess(e);case"CONDITIONAL":return this.evaluateConditional(e);default:throw new Error(`Invokers Expression Error: Unknown AST node type: ${e.type}`)}}finally{this.recursionDepth--}}evaluateBinaryOp(e){let t=this.evaluate(e.left),n=this.evaluate(e.right),r=e.operator;if(t==null||Number.isNaN(t)||n==null||Number.isNaN(n))switch(r){case"===":return t===n;case"!==":return t!==n;case"==":return t==n;case"!=":return t!=n;case"&&":return t&&n;case"||":return t||n;default:return["+","-","*","/","%"].includes(r)?Number.NaN:!1}switch(r){case"+":return t+n;case"-":return t-n;case"*":return t*n;case"/":if(n===0)throw new Error("Invokers Expression Error: Division by zero");return t/n;case"%":return t%n;case"===":return t===n;case"!==":return t!==n;case"==":return t==n;case"!=":return t!=n;case"<":return t<n;case">":return t>n;case"<=":return t<=n;case">=":return t>=n;case"&&":return t&&n;case"||":return t||n;default:throw new Error(`Invokers Expression Error: Unknown binary operator: ${r}`)}}evaluateUnaryOp(e){let t=this.evaluate(e.right),n=e.operator;switch(n){case"!":return!t;case"-":return-t;default:throw new Error(`Invokers Expression Error: Unknown unary operator: ${n}`)}}evaluateMemberAccess(e){let t=this.evaluate(e.object);if(t!=null&&(typeof t=="object"||typeof t=="string")){let n=e.property;if(typeof n=="string"&&this.isSafeProperty(n))return t[n]}}evaluateArrayAccess(e){let t=this.evaluate(e.object),n=this.evaluate(e.index);if(typeof n=="string"){if(!this.isSafeProperty(n))return}else if(typeof n=="number"){if(n<0||n>1e4||!Number.isInteger(n))return}else return;if(t&&(typeof t=="object"||Array.isArray(t))&&n in t)return t[n]}resolveIdentifier(e){if(!this.isSafeProperty(e))throw new Error(`Invokers Expression Error: Access to '${e}' is not allowed`);if(e in this.context)return this.context[e]}evaluateConditional(e){return this.evaluate(e.test)?this.evaluate(e.consequent):this.evaluate(e.alternate)}};Y.MAX_RECURSION_DEPTH=100;var K=Y;var le=class{constructor(e=100){this.cache=new Map;this.maxSize=e}get(e){let t=this.cache.get(e);return t!==void 0&&(this.cache.delete(e),this.cache.set(e,t)),t}set(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxSize){let n=this.cache.keys().next().value;n!==void 0&&this.cache.delete(n)}this.cache.set(e,t)}clear(){this.cache.clear()}},be=new le,U=class U{constructor(){this.evaluations=[]}canEvaluate(){let e=Date.now();return this.evaluations=this.evaluations.filter(t=>e-t<U.WINDOW_SIZE_MS),this.evaluations.length>=U.MAX_EVALUATIONS_PER_SECOND?!1:(this.evaluations.push(e),!0)}};U.MAX_EVALUATIONS_PER_SECOND=1e3,U.WINDOW_SIZE_MS=1e3;var de=U,Ye=new de;function xe(a,e){if(!Ye.canEvaluate()){console.warn("Invokers: Expression evaluation rate limit exceeded");return}try{let t=be.get(a);if(!t){let o=new G().tokenize(a);t=new z(o).parse(),be.set(a,t)}return new K(e).evaluate(t)}catch(t){let n=t instanceof Error?t.message:String(t);if(n.includes("not allowed")||n.includes("potentially unsafe")||n.includes("invalid characters")||n.includes("Maximum recursion depth")||n.includes("Expression too"))throw t;if(n.includes("Maximum call stack"))throw new Error("Invokers Expression Error: Maximum recursion depth exceeded");console.error(`Invokers Expression Error in "${a}": ${n}`);return}}function Re(a="invoker",e=8){let t="";if(typeof crypto!="undefined"&&crypto.getRandomValues){let n=new Uint8Array(e);crypto.getRandomValues(n),t=Array.from(n,r=>r.toString(36)).join("").slice(0,e)}else t=Math.random().toString(36).substring(2,2+e);return`${a}-${t}`}function H(a,e){if(typeof a!="string")return"";a.length>1e4&&(console.warn("Invokers: Template too large, truncating"),a=a.substring(0,1e4));let t=a,n=0;return t=t.replace(/\{\{(.*?)\}\}/g,(r,o)=>{if(n++,n>50)return console.warn("Invokers: Too many interpolations in template, stopping"),"";try{if(o.trim()==="__uid")return Re();let s=xe(o.trim(),e);return s!=null?String(s):""}catch(s){return console.warn(`Invokers: Expression evaluation failed in interpolation: ${o}`,s),""}}),t}function k(a,e){let t=a.trim();if(t.startsWith("@")){let r=t.match(/^@([a-z]+)\((.*)\)$/);if(r){let o=r[1],s=r[2];switch(s=s.replace(/\\([()])/g,"$1"),o){case"closest":let i=e.closest(s);return i?[i]:[];case"child":let c=e.querySelector(s);return c?[c]:[];case"children":return Array.from(e.querySelectorAll(s));default:return console.warn(`Invokers: Unknown contextual selector type "@${o}".`),[]}}return[]}if(t.startsWith("#")){let r=document.querySelector(t);return r?[r]:[]}let n=document.getElementById(t);if(n)return[n];try{return Array.from(document.querySelectorAll(t))}catch(r){return console.error(`Invokers: Invalid CSS selector in commandfor: "${t}"`,r),[]}}var Z={"--media:toggle":async({invoker:a,targetElement:e})=>{let t=M(e,{tagName:["video","audio"]});if(t.length>0)throw l(`Media command failed: ${t.join(", ")}`,"error",{command:"--media:toggle",element:a,recovery:"Ensure commandfor points to a <video> or <audio> element."});let n=e,r=a.dataset.playText||"Pause",o=a.dataset.pauseText||"Play";try{n.paused?(await n.play(),a.textContent=r,a.setAttribute("aria-pressed","true")):(n.pause(),a.textContent=o,a.setAttribute("aria-pressed","false"))}catch(s){throw l("Failed to toggle media playback","error",{command:"--media:toggle",element:a,cause:s,recovery:s.name==="NotAllowedError"?"Media autoplay blocked by browser. User interaction may be required.":"Check that the media element has a valid source and is ready to play."})}},"--media:seek":({invoker:a,targetElement:e,params:t})=>{let n=M(e,{tagName:["video","audio"]});if(n.length>0)throw l(`Media command failed: ${n.join(", ")}`,"error",{command:"--media:seek",element:a,recovery:"Ensure commandfor points to a <video> or <audio> element."});let r=e,o=parseFloat(t[0]);if(isNaN(o))throw l("Media seek command requires a numeric value for seconds","error",{command:"--media:seek",element:a,context:{provided:t[0]},recovery:"Use format: --media:seek:10 (for 10s) or --media:seek:-5 (for -5s)."});r.currentTime=Math.max(0,Math.min(r.duration,r.currentTime+o))},"--media:mute":({invoker:a,targetElement:e})=>{let t=M(e,{tagName:["video","audio"]});if(t.length>0)throw l(`Media command failed: ${t.join(", ")}`,"error",{command:"--media:mute",element:a,recovery:"Ensure commandfor points to a <video> or <audio> element."});let n=e;n.muted=!n.muted,a.setAttribute("aria-pressed",String(n.muted))},"--carousel:nav":({invoker:a,targetElement:e,params:t})=>{let[n]=t;if(n!=="next"&&n!=="prev")throw l('Carousel nav requires a direction parameter of "next" or "prev"',"error",{command:"--carousel:nav",element:a,recovery:"Use format: --carousel:nav:next or --carousel:nav:prev"});let r=Array.from(e.children);if(r.length<2)return;let o=r.findIndex(d=>!d.hasAttribute("hidden")),s=o===-1?0:o,i=(n==="next"?s+1:s-1+r.length)%r.length,c=()=>{r.forEach((d,m)=>{d.toggleAttribute("hidden",m!==i)})};document.startViewTransition?document.startViewTransition(c):c()},"--clipboard:copy":async({invoker:a,targetElement:e})=>{if(!navigator.clipboard)throw l("Clipboard API not available","error",{command:"--clipboard:copy",element:a,recovery:"This feature requires a secure context (HTTPS)."});let t=a.textContent||"",n=a.dataset.feedbackText||"Copied!",r=a.dataset.errorText||"Error!",o=e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement?e.value:e.textContent||"";a.setAttribute("disabled","");try{await navigator.clipboard.writeText(o),a.textContent=n}catch(s){throw a.textContent=r,l("Failed to copy text to clipboard","error",{command:"--clipboard:copy",element:a,cause:s})}finally{setTimeout(()=>{a.textContent=t,a.removeAttribute("disabled")},2e3)}},"--form:reset":({invoker:a,targetElement:e})=>{let t=M(e,{tagName:["form"]});if(t.length>0)throw l(`Form reset failed: ${t.join(", ")}`,"error",{command:"--form:reset",element:a,recovery:"Ensure commandfor points to a <form> element."});e.reset()},"--form:submit":({invoker:a,targetElement:e})=>{let t=M(e,{tagName:["form"]});if(t.length>0)throw l(`Form submit failed: ${t.join(", ")}`,"error",{command:"--form:submit",element:a,recovery:"Ensure commandfor points to a <form> element."});e.requestSubmit()},"--input:step":({invoker:a,targetElement:e,params:t})=>{if(!(e instanceof HTMLInputElement)||e.type!=="number")throw l('Input step target must be an <input type="number">',"error",{command:"--input:step",element:a});let n=parseFloat(t[0]||"1");if(isNaN(n))throw l("Input step requires a valid numeric parameter","error",{command:"--input:step",element:a,context:{provided:t[0]},recovery:"Use --input:step:1 or --input:step:-1"});n>0?e.stepUp(n):n<0&&e.stepDown(Math.abs(n)),e.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0}))},"--scroll:to":({targetElement:a})=>{a.scrollIntoView({behavior:"smooth",block:"start"})},"--dom:remove":({targetElement:a})=>{let e=()=>a.remove();document.startViewTransition?document.startViewTransition(e):e()},"--dom:replace":({invoker:a,targetElement:e,params:t})=>{let n=t[0]||"outer",r=B(a,"replace").cloneNode(!0);N()&&(r=V(r,a));let o=()=>{n==="inner"?e.replaceChildren(r):e.replaceWith(r)};document.startViewTransition?document.startViewTransition(o):o()},"--dom:swap":({invoker:a,targetElement:e,params:t})=>{let[n="inner"]=t,r=B(a,"swap").cloneNode(!0);if(N()){let s={this:{...a,dataset:{...a.dataset},value:a.value||""},data:document.body.dataset,event:a.triggeringEvent},i=document.createElement("div");i.appendChild(r.cloneNode(!0));let c=i.innerHTML,d=H(c,s);i.innerHTML=d;let m=document.createDocumentFragment();for(;i.firstChild;)m.appendChild(i.firstChild);r=V(m,a)}let o=()=>{n==="outer"?e.replaceWith(r):e.replaceChildren(r)};document.startViewTransition?document.startViewTransition(o):o()},"--dom:append":({invoker:a,targetElement:e,params:t})=>{let n=t[0]||"inner",r=B(a,"append").cloneNode(!0);N()&&(r=V(r,a));let o=()=>{n==="outer"?e.after(r):e.append(r)};document.startViewTransition?document.startViewTransition(o):o()},"--dom:prepend":({invoker:a,targetElement:e,params:t})=>{let n=t[0]||"inner",r=B(a,"prepend").cloneNode(!0);N()&&(r=V(r,a));let o=()=>{n==="outer"?e.before(r):e.prepend(r)};document.startViewTransition?document.startViewTransition(o):o()},"--dom:wrap":({invoker:a,targetElement:e,params:t})=>{let n=t[0]||null,r;if(n){r=document.createElement(n);let s=a.dataset.wrapperClass,i=a.dataset.wrapperId;s&&(r.className=s),i&&(r.id=i)}else{let s=B(a,"wrap").cloneNode(!0);N()&&(s=V(s,a));let i=Array.from(s.children);if(i.length!==1)throw l("Wrap template must contain exactly one root element","error",{command:"--dom:wrap",element:a});r=i[0]}let o=()=>{e.replaceWith(r),r.appendChild(e)};document.startViewTransition?document.startViewTransition(o):o()},"--dom:unwrap":({targetElement:a})=>{let e=a.parentElement;if(!e)return;let t=()=>{e.replaceWith(a)};document.startViewTransition?document.startViewTransition(t):t()},"--dom:toggle-empty-class":({targetElement:a,params:e})=>{let t=e[0];if(!t)throw l("Toggle empty class command requires a class name parameter","error",{command:"--dom:toggle-empty-class",element:a});let n=a.children.length>0;a.classList.toggle(t,!n)},"--data:set":({invoker:a,targetElement:e,params:t})=>{let n=t[0],r=t[1];if(!n)throw l("Data set command requires a key parameter","error",{command:"--data:set",element:a});if(N()&&r){let o={this:{...a,dataset:{...a.dataset},value:a.value||""},data:document.body.dataset,event:a.triggeringEvent};r=H(r,o)}e.dataset[n]=r||""},"--data:copy":({invoker:a,targetElement:e,params:t})=>{let n=t[0];if(!n)throw l("Data copy command requires a key parameter","error",{command:"--data:copy",element:a});let r=a.dataset.copyFrom,o=a;if(r&&(o=document.querySelector(r),!o))throw l(`Source element with selector "${r}" not found`,"error",{command:"--data:copy",element:a});let s=o.dataset[n];s!==void 0&&(e.dataset[n]=s)},"--data:set:array:push":({invoker:a,targetElement:e,params:t})=>{let n=t[0];if(!n)throw l("Array push command requires an array key parameter","error",{command:"--data:set:array:push",element:a});let r=a.dataset.value;if(!r)throw l("Array push command requires a data-value attribute","error",{command:"--data:set:array:push",element:a});let o=[];try{let s=e.dataset[n];o=s?JSON.parse(s):[]}catch(s){o=[]}try{let s=JSON.parse(r);o.push(s),e.dataset[n]=JSON.stringify(o)}catch(s){throw l("Invalid JSON in data-value attribute","error",{command:"--data:set:array:push",element:a})}},"--data:set:array:remove":({invoker:a,targetElement:e,params:t})=>{let n=t[0];if(!n)throw l("Array remove command requires an array key parameter","error",{command:"--data:set:array:remove",element:a});let r=parseInt(a.dataset.index||"0",10);if(isNaN(r))throw l("Array remove command requires a valid data-index attribute","error",{command:"--data:set:array:remove",element:a});let o=[];try{let s=e.dataset[n];o=s?JSON.parse(s):[]}catch(s){o=[]}r>=0&&r<o.length&&(o.splice(r,1),e.dataset[n]=JSON.stringify(o))},"--data:set:array:update":({invoker:a,targetElement:e,params:t})=>{let n=t[0];if(!n)throw l("Array update command requires an array key parameter","error",{command:"--data:set:array:update",element:a});let r=parseInt(a.dataset.index||"0",10),o=a.dataset.value;if(isNaN(r))throw l("Array update command requires a valid data-index attribute","error",{command:"--data:set:array:update",element:a});if(!o)throw l("Array update command requires a data-value attribute","error",{command:"--data:set:array:update",element:a});let s=[];try{let i=e.dataset[n];s=i?JSON.parse(i):[]}catch(i){s=[]}if(r>=0&&r<s.length)try{let i=JSON.parse(o);s[r]={...s[r],...i},e.dataset[n]=JSON.stringify(s)}catch(i){throw l("Invalid JSON in data-value attribute","error",{command:"--data:set:array:update",element:a})}},"--data:set:array:insert":({invoker:a,targetElement:e,params:t})=>{let n=t[0];if(!n)throw l("Array insert command requires an array key parameter","error",{command:"--data:set:array:insert",element:a});let r=parseInt(a.dataset.index||"0",10),o=a.dataset.value;if(isNaN(r))throw l("Array insert command requires a valid data-index attribute","error",{command:"--data:set:array:insert",element:a});if(!o)throw l("Array insert command requires a data-value attribute","error",{command:"--data:set:array:insert",element:a});let s=[];try{let i=e.dataset[n];s=i?JSON.parse(i):[]}catch(i){s=[]}if(r>=0&&r<=s.length)try{let i=JSON.parse(o);s.splice(r,0,i),e.dataset[n]=JSON.stringify(s)}catch(i){throw l("Invalid JSON in data-value attribute","error",{command:"--data:set:array:insert",element:a})}},"--data:set:array:unshift":({invoker:a,targetElement:e,params:t})=>{let n=t[0];if(!n)throw l("Array unshift command requires an array key parameter","error",{command:"--data:set:array:unshift",element:a});let r=a.dataset.value;if(!r)throw l("Array unshift command requires a data-value attribute","error",{command:"--data:set:array:unshift",element:a});let o=[];try{let s=e.dataset[n];o=s?JSON.parse(s):[]}catch(s){o=[]}try{let s=JSON.parse(r);o.unshift(s),e.dataset[n]=JSON.stringify(o)}catch(s){throw l("Invalid JSON in data-value attribute","error",{command:"--data:set:array:unshift",element:a})}},"--data:set:array:clear":({targetElement:a,params:e})=>{let t=e[0];if(!t)throw l("Array clear command requires an array key parameter","error",{command:"--data:set:array:clear",element:a});a.dataset[t]=JSON.stringify([])},"--data:set:array:sort":({invoker:a,targetElement:e,params:t})=>{let n=t[0];if(!n)throw l("Array sort command requires an array key parameter","error",{command:"--data:set:array:sort",element:a});let r=a.dataset.sortBy||a.dataset.sort_by,o=a.dataset.sortOrder||a.dataset.sort_order||"asc";if(!r)throw l("Array sort command requires a data-sort-by attribute","error",{command:"--data:set:array:sort",element:a});let s=[];try{let i=e.dataset[n];s=i?JSON.parse(i):[]}catch(i){s=[]}s.sort((i,c)=>{let d=i[r],m=c[r],f=0;return d<m?f=-1:d>m&&(f=1),o==="desc"?-f:f}),e.dataset[n]=JSON.stringify(s)},"--data:set:array:filter":({invoker:a,targetElement:e,params:t})=>{let n=t[0];if(!n)throw l("Array filter command requires an array key parameter","error",{command:"--data:set:array:filter",element:a});let r=a.dataset.filterBy||a.dataset.filter_by,o=a.dataset.filterValue||a.dataset.filter_value,s=a.dataset.resultKey||a.dataset.result_key||`${n}-filtered`;if(!r)throw l("Array filter command requires a data-filter-by attribute","error",{command:"--data:set:array:filter",element:a});let i=[];try{let d=e.dataset[n];i=d?JSON.parse(d):[]}catch(d){i=[]}let c=i.filter(d=>{let m=d[r];return o==="true"?m===!0:o==="false"?m===!1:String(m)===o});e.dataset[s]=JSON.stringify(c)},"--data:set:new-todo":({invoker:a,targetElement:e})=>{let t=Xe(a),n={id:Ze(),title:t.title||"",description:t.description||"",priority:t.priority||"medium",tags:t.tags||"",completed:!1,created:new Date().toLocaleDateString()},r=[];try{let o=e.dataset.todos;r=o?JSON.parse(o):[]}catch(o){r=[]}r.push(n),e.dataset.todos=JSON.stringify(r),e.dispatchEvent(new CustomEvent("todo-updated",{bubbles:!0}))},"--data:set:filter:status":({invoker:a,targetElement:e})=>{let t=a.value;e.dataset.filterStatus=t,e.dispatchEvent(new CustomEvent("filter-changed",{bubbles:!0}))},"--data:set:filter:priority":({invoker:a,targetElement:e})=>{let t=a.value;e.dataset.filterPriority=t,e.dispatchEvent(new CustomEvent("filter-changed",{bubbles:!0}))},"--data:set:search":({invoker:a,targetElement:e})=>{let t=a.value;e.dataset.searchTerm=t,e.dispatchEvent(new CustomEvent("filter-changed",{bubbles:!0}))},"--data:set:sort:by":({invoker:a,targetElement:e})=>{let t=a.value;e.dataset.sortBy=t,e.dispatchEvent(new CustomEvent("filter-changed",{bubbles:!0}))},"--data:set:sort:order":({invoker:a,targetElement:e})=>{let t=a.value;e.dataset.sortOrder=t,e.dispatchEvent(new CustomEvent("filter-changed",{bubbles:!0}))},"--data:set:toggle":({invoker:a,targetElement:e,params:t})=>{let n=t[0];if(!n)throw l("Toggle command requires a todo ID parameter","error",{command:"--data:set:toggle",element:a});let r=[];try{let s=e.dataset.todos;r=s?JSON.parse(s):[]}catch(s){r=[]}let o=r.findIndex(s=>s.id===n);o!==-1&&(r[o].completed=!r[o].completed,e.dataset.todos=JSON.stringify(r),e.dispatchEvent(new CustomEvent("todo-updated",{bubbles:!0})))},"--data:set:edit":({invoker:a,targetElement:e,params:t})=>{let n=t[0];if(!n)throw l("Edit command requires a todo ID parameter","error",{command:"--data:set:edit",element:a});e.dataset.editingId=n,e.dispatchEvent(new CustomEvent("edit-mode-changed",{bubbles:!0}))},"--data:set:delete":({invoker:a,targetElement:e,params:t})=>{let n=t[0];if(!n)throw l("Delete command requires a todo ID parameter","error",{command:"--data:set:delete",element:a});let r=[];try{let s=e.dataset.todos;r=s?JSON.parse(s):[]}catch(s){r=[]}let o=r.filter(s=>s.id!==n);e.dataset.todos=JSON.stringify(o),e.dispatchEvent(new CustomEvent("todo-updated",{bubbles:!0}))},"--data:set:cancel-edit":({invoker:a,targetElement:e,params:t})=>{if(!t[0])throw l("Cancel edit command requires a todo ID parameter","error",{command:"--data:set:cancel-edit",element:a});delete e.dataset.editingId,e.dispatchEvent(new CustomEvent("edit-mode-changed",{bubbles:!0}))},"--data:set:save-edit":({invoker:a,targetElement:e,params:t})=>{let n=t[0];if(!n)throw l("Save edit command requires a todo ID parameter","error",{command:"--data:set:save-edit",element:a});let r=document.getElementById(`edit-form-${n}`);if(!r)throw l(`Edit form for id ${n} not found`,"error",{command:"--data:set:save-edit",element:a});let o={title:r.dataset.title||"",description:r.dataset.description||"",priority:r.dataset.priority||"medium"},s=[];try{let c=e.dataset.todos;s=c?JSON.parse(c):[]}catch(c){s=[]}let i=s.findIndex(c=>c.id===n);i!==-1&&(s[i]={...s[i],...o},e.dataset.todos=JSON.stringify(s),delete e.dataset.editingId,e.dispatchEvent(new CustomEvent("todo-updated",{bubbles:!0})))},"--data:set:bulk-action:complete-all":({targetElement:a})=>{let e=[];try{let n=a.dataset.todos;e=n?JSON.parse(n):[]}catch(n){e=[]}let t=e.map(n=>n.completed?n:{...n,completed:!0});a.dataset.todos=JSON.stringify(t),a.dispatchEvent(new CustomEvent("todo-updated",{bubbles:!0}))},"--data:set:bulk-action:clear-completed":({targetElement:a})=>{let e=[];try{let n=a.dataset.todos;e=n?JSON.parse(n):[]}catch(n){e=[]}let t=e.filter(n=>!n.completed);a.dataset.todos=JSON.stringify(t),a.dispatchEvent(new CustomEvent("todo-updated",{bubbles:!0}))},"--data:set:bulk-action:export":({targetElement:a})=>{let e=[];try{let s=a.dataset.todos;e=s?JSON.parse(s):[]}catch(s){e=[]}let t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json"}),r=URL.createObjectURL(n),o=document.createElement("a");o.href=r,o.download=`todos-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(r)},"--cookie:set":({invoker:a,params:e})=>{let t=e[0],n=e[1];if(!t)throw l("Cookie set command requires a key parameter","error",{command:"--cookie:set",element:a});let r=`${encodeURIComponent(t)}=${encodeURIComponent(n||"")}`,o=a.dataset.cookieExpires;if(o){let s=parseInt(o,10);if(!isNaN(s)){let i=new Date;i.setTime(i.getTime()+s*24*60*60*1e3),r+=`; expires=${i.toUTCString()}`}}r+="; path=/",document.cookie=r},"--cookie:get":({targetElement:a,params:e})=>{let t=e[0];if(!t)throw l("Cookie get command requires a key parameter","error",{command:"--cookie:get",element:a});let n=document.cookie.split(";");for(let r of n){let[o,s]=r.trim().split("=");if(decodeURIComponent(o)===t){a.textContent=decodeURIComponent(s||"");return}}a.textContent=""},"--cookie:remove":({params:a})=>{let e=a[0];if(!e)throw l("Cookie remove command requires a key parameter","error",{command:"--cookie:remove"});document.cookie=`${encodeURIComponent(e)}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/`},"--command:trigger":({targetElement:a,params:e})=>{let t=e[0]||"click",n=new Event(t,{bubbles:!0,cancelable:!0});a.dispatchEvent(n)},"--command:delay":({params:a})=>{let e=parseInt(a[0],10);if(isNaN(e)||e<0)throw l("Delay command requires a valid positive number of milliseconds","error",{command:"--command:delay"});return new Promise(t=>setTimeout(t,e))},"--on:interval":({invoker:a,targetElement:e,params:t})=>{let n=parseInt(t[0],10);if(isNaN(n)||n<=0)throw l("Interval command requires a valid positive interval in milliseconds","error",{command:"--on:interval",element:a});let r=a.dataset.intervalCommand;if(!r)throw l("Interval command requires data-interval-command attribute","error",{command:"--on:interval",element:a});let o=a._invokerIntervalId;o&&clearInterval(o);let s=setInterval(()=>{if(window.Invoker){let c=e.id||`__invoker-target-${Date.now()}`;e.id||(e.id=c),window.Invoker.executeCommand(r,c,a)}},n);a._invokerIntervalId=s;let i=new MutationObserver(()=>{document.contains(a)||(clearInterval(s),i.disconnect())});i.observe(document.body,{childList:!0,subtree:!0})},"--bind":({invoker:a,targetElement:e,params:t})=>{let n=t.join(":");if(!n)throw l("Bind command requires a source property (e.g., value, text, data:name)","error",{command:"--bind",element:a});let r,o=n==="value"&&(a instanceof HTMLInputElement||a instanceof HTMLTextAreaElement||a instanceof HTMLSelectElement)?a:e;if(n==="value"&&(o instanceof HTMLInputElement||o instanceof HTMLTextAreaElement||o instanceof HTMLSelectElement))r=o.value;else if(n==="text")r=o.textContent;else if(n==="html")r=o.innerHTML;else if(n.startsWith("attr:")){let d=n.substring(5);r=o.getAttribute(d)}else if(n.startsWith("data:")){let d=n.substring(5).replace(/-([a-z])/g,(m,f)=>f.toUpperCase());r=o.dataset[d]}else throw l(`Invalid source property for --bind: "${n}"`,"error",{command:"--bind",element:a});let s=a.dataset.bindTo,i=s?k(s,a):[e],c=a.dataset.bindAs||"text";i.forEach(d=>{if(c==="value"&&(d instanceof HTMLInputElement||d instanceof HTMLTextAreaElement||d instanceof HTMLSelectElement))d.value=r||"";else if(c==="text")d.textContent=r||"";else if(c==="html")d.innerHTML=me(r||"");else if(c.startsWith("attr:")){let m=c.substring(5);r==null?d.removeAttribute(m):d.setAttribute(m,r)}else if(c.startsWith("data:")){let m=c.substring(5).replace(/-([a-z])/g,(f,u)=>u.toUpperCase());r==null?delete d.dataset[m]:d.dataset[m]=r}else c==="class:add"?r&&d.classList.add(r):c==="class:remove"&&r&&d.classList.remove(r)})},"--text:copy":a=>{let{invoker:e,targetElement:t}=a,n=e.dataset.copyFrom,r=e;if(n&&(r=document.querySelector(n),!r))throw l(`Source element with selector "${n}" not found`,"error",{command:"--text:copy",element:e});let o=r instanceof HTMLInputElement||r instanceof HTMLTextAreaElement?r.value:r.textContent||"";t.textContent=o},"--text:set":({targetElement:a,params:e})=>{a.textContent=e.join(":")},"--attr:set":({targetElement:a,params:e})=>{let t=e[0],n=e.slice(1).join(":");a.setAttribute(t,n)},"--attr:remove":({targetElement:a,params:e})=>{let t=e[0];a.removeAttribute(t)},"--fetch:get":async({invoker:a,targetElement:e})=>{let t=a.dataset.url;if(!t)throw l("Fetch GET command requires a data-url attribute","error",{command:"--fetch:get",element:a,recovery:'Add data-url="/your/endpoint" to the button.'});let n={this:{...a,value:a.value||""},event:a.triggeringEvent};t=H(t,n);let r=new CustomEvent("fetch:before",{detail:{url:t,invoker:a},cancelable:!0});if(window.dispatchEvent(r),r.defaultPrevented){W(a,!1);return}W(a,!0),X(a,e,"data-loading-template");try{let o=new AbortController,s=setTimeout(()=>o.abort(),3e4),i=await fetch(t,{method:"GET",headers:{Accept:"text/html",...Te(a)},signal:o.signal});if(clearTimeout(s),!i.ok)throw l(`HTTP Error: ${i.status} ${i.statusText}`,"error",{command:"--fetch:get",element:a,context:{url:t,status:i.status}});let c=await i.text(),d=Ce(c),m=()=>e.replaceChildren(d);await(document.startViewTransition?document.startViewTransition(m).finished:Promise.resolve(m()))}catch(o){throw X(a,e,"data-error-template"),o instanceof Error&&"severity"in o?o:l("Fetch GET failed","error",{command:"--fetch:get",element:a,cause:o,context:{url:t},recovery:"Check the URL, network connection, and server response."})}finally{W(a,!1)}},"--fetch:send":async({invoker:a,targetElement:e})=>{let t=M(e,{tagName:["form"]});if(t.length>0)throw l(`Fetch send failed: ${t.join(", ")}`,"error",{command:"--fetch:send",element:a,recovery:"Ensure commandfor points to a <form> element."});let n=e,r=a.dataset.responseTarget,o=r?document.querySelector(r):n;if(!o)throw l(`Response target "${r}" not found`,"error",{command:"--fetch:send",element:a});W(a,!0),X(a,o,"data-loading-template");try{let s=await fetch(n.action,{method:n.method||"POST",body:new FormData(n),headers:Te(a)});if(!s.ok)throw new Error(`HTTP Error: ${s.status} ${s.statusText}`);let i=await s.text(),c=Ce(i),d=()=>o.replaceChildren(c);await(document.startViewTransition?document.startViewTransition(d).finished:Promise.resolve(d()))}catch(s){throw X(a,o,"data-error-template"),l("Fetch send failed","error",{command:"--fetch:send",element:a,cause:s,recovery:"Check the form action, network connection, and server response."})}finally{W(a,!1)}},"--navigate:to":a=>{var t;let e=a.params.join(":");if(!e)throw l("Navigate command requires a URL parameter","error",{command:"--navigate:to",element:a.invoker,recovery:"Use format: --navigate:to:/your/path"});(t=window.history)!=null&&t.pushState?(window.history.pushState({},"",e),window.dispatchEvent(new PopStateEvent("popstate",{state:{}}))):window.location.href=e},"--emit":({params:a,targetElement:e})=>{let[t,...n]=a;if(!t)throw l("Emit command requires an event type parameter","error",{command:"--emit",recovery:"Use format: --emit:event-type or --emit:event-type:detail"});let r=n.length>0?n.join(":"):void 0;if(typeof r=="string"&&(r.startsWith("{")||r.startsWith("[")))try{r=JSON.parse(r)}catch(s){}let o=new CustomEvent(t,{bubbles:!0,composed:!0,detail:r});(e||document.body).dispatchEvent(o)}};function B(a,e){let t=a.dataset.templateId;if(t){let n=document.getElementById(t);if(!(n instanceof HTMLTemplateElement))throw l(`Source <template> with ID "${t}" not found`,"error",{command:`--dom:${e}`,element:a});return n.content}throw l(`DOM command --dom:${e} requires a data-template-id attribute`,"error",{command:`--dom:${e}`,element:a})}function W(a,e){a.toggleAttribute("disabled",e),a.setAttribute("aria-busy",String(e))}function X(a,e,t){let n=t.replace("data-","").replace(/-(\w)/g,(s,i)=>i.toUpperCase()),r=a.dataset[n];if(!r||!e)return;let o=document.getElementById(r);if(!(o instanceof HTMLTemplateElement)){let s=l(`Feedback template "#${r}" not found or is not a <template>`,"warning",{element:a});console.error(s);return}e.replaceChildren(o.content.cloneNode(!0))}function Xe(a){let e={},t=new FormData(a);for(let[n,r]of t.entries())e[n]=r;return e}function Ze(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}function Ce(a){let e=me(a),t=new DOMParser().parseFromString(e,"text/html"),n=document.createDocumentFragment();return n.append(...Array.from(t.body.childNodes)),n}function V(a,e){let t=e.dataset.withJson;if(!t)return a;let n=document.getElementById("text-input"),r={this:{...e,value:(n==null?void 0:n.value)||""},event:e.triggeringEvent},o;try{o=H(t,r)}catch(c){return console.error("Invokers: Failed to interpolate data-with-json:",c),a}let s;try{s=JSON.parse(o)}catch(c){return console.error("Invokers: Invalid JSON in data-with-json attribute:",c),a}a.querySelectorAll("[data-tpl-text]").forEach(c=>{let d=c.getAttribute("data-tpl-text");if(d&&s.hasOwnProperty(d)){let m=String(s[d]);if(c.children.length===0)c.textContent=m;else{let f=document.createTextNode(m);c.insertBefore(f,c.firstChild)}}}),a.querySelectorAll("[data-tpl-attr]").forEach(c=>{let d=c.getAttribute("data-tpl-attr");d&&d.split(",").forEach(m=>{let[f,u]=m.split(":").map(h=>h.trim());f&&u&&s.hasOwnProperty(u)&&c.setAttribute(f,String(s[u]))})}),a.querySelectorAll("[data-tpl-value]").forEach(c=>{let d=c.getAttribute("data-tpl-value");d&&s.hasOwnProperty(d)&&"value"in c&&(c.value=String(s[d]))});let i=a.firstElementChild;return i!=null&&i.id&&a.querySelectorAll('[commandfor^="@"]').forEach(c=>{let d=c.getAttribute("commandfor");if(d!=null&&d.startsWith("@closest(")){let m=d.match(/^@closest\(([^)]+)\)$/);if(m){let f=m[1];i.matches(f)&&c.setAttribute("commandfor",i.id)}}}),a}function Te(a){let e={};for(let t in a.dataset)if(t.startsWith("header")){let n=t.substring(6).replace(/([A-Z])/g,"-$1").toLowerCase();n&&(e[n]=a.dataset[t])}return e}function Ie(){return typeof HTMLButtonElement!="undefined"&&"interestForElement"in HTMLButtonElement.prototype}var D=class D{constructor(){this.initialized=!1;this.attributeName="interestfor";this.interestEventName="interest";this.loseInterestEventName="loseinterest";this.interestDelayStartProp="--interest-delay-start";this.interestDelayEndProp="--interest-delay-end";this.interestDelayProp="--interest-delay";this.dataField="__interestForData";this.targetDataField="__interestForTargetData";this.invokersWithInterest=new Set;this.touchInProgress=!1;this.InterestState={NoInterest:"none",FullInterest:"full"};this.Source={Hover:"hover",DeHover:"dehover",Focus:"focus",Blur:"blur",Touch:"touch"}}static getInstance(){return D.instance||(D.instance=new D),D.instance}apply(){if(window.interestForPolyfillInstalled)return;window.interestForPolyfillInstalled=!0;let e=Ie();e&&!window.interestForUsePolyfillAlways||(e&&this.disableNativeSupport(),this.setupPolyfill(),this.initialized=!0,console.log(`Interest Invokers polyfill installed (native: ${e}).`))}disableNativeSupport(){let e=t=>{t.isTrusted&&(t.preventDefault(),t.stopImmediatePropagation())};document.body.addEventListener(this.interestEventName,e,{capture:!0}),document.body.addEventListener(this.loseInterestEventName,e,{capture:!0})}setupPolyfill(){this.registerCustomProperties(),this.addEventHandlers(),this.setupElementMixins()}registerCustomProperties(){let e=document.createElement("style");e.textContent=`
      @property ${this.interestDelayStartProp} {
        syntax: "normal | <time>";
        inherits: false;
        initial-value: normal;
      }
      @property ${this.interestDelayEndProp} {
        syntax: "normal | <time>";
        inherits: false;
        initial-value: normal;
      }
      @property ${this.interestDelayProp} {
        syntax: "[ normal | <time> ]{1,2}";
        inherits: false;
        initial-value: normal;
      }
    `,document.head.appendChild(e),document[this.dataField]={globalPropsStyle:e}}setupElementMixins(){this.applyInterestInvokerMixin(HTMLButtonElement),this.applyInterestInvokerMixin(HTMLAnchorElement),this.applyInterestInvokerMixin(HTMLAreaElement),typeof SVGAElement!="undefined"&&this.applyInterestInvokerMixin(SVGAElement)}applyInterestInvokerMixin(e){Object.defineProperty(e.prototype,"interestForElement",{enumerable:!0,configurable:!0,get(){let t=this.getAttribute("interestfor");return t?document.getElementById(t):null},set(t){if(t===null)this.removeAttribute("interestfor");else if(t&&typeof t=="object"&&"id"in t)this.setAttribute("interestfor",t.id||"");else throw new TypeError("interestForElement must be an element or null")}})}addEventHandlers(){document.body.addEventListener("mouseover",e=>this.handleInterestHoverOrFocus(e.target,this.Source.Hover)),document.body.addEventListener("mouseout",e=>this.handleInterestHoverOrFocus(e.target,this.Source.DeHover)),document.body.addEventListener("focusin",e=>this.handleInterestHoverOrFocus(e.target,this.Source.Focus)),document.body.addEventListener("focusout",e=>this.handleInterestHoverOrFocus(e.target,this.Source.Blur)),document.body.addEventListener("keydown",e=>{e.key==="Escape"&&this.invokersWithInterest.forEach(t=>{this.clearState(t)})}),this.setupTouchHandlers()}setupTouchHandlers(){document.body.addEventListener("touchstart",n=>{this.touchInProgress=!0;let r=n.target.closest("button[interestfor]");if(r){this.initializeDataField(r);let o=r[this.dataField];o.longPressTimer=setTimeout(()=>{this.gainOrLoseInterest(r,this.getInterestForTarget(r),this.InterestState.FullInterest),o.longPressTimer=null},500)}});let t=n=>{let r=n.target.closest("button[interestfor]");if(r){let o=r[this.dataField];o!=null&&o.longPressTimer&&(clearTimeout(o.longPressTimer),o.longPressTimer=null)}};document.body.addEventListener("touchend",n=>{t(n),this.touchInProgress=!1}),document.body.addEventListener("touchmove",t)}handleInterestHoverOrFocus(e,t){var s,i,c,d,m,f;if(this.touchInProgress||!e.isConnected)return;if(!this.getInterestForTarget(e)){this.handleUpstreamInterest(e,t);return}if(e instanceof HTMLButtonElement&&e.disabled)return;this.initializeDataField(e);let r=e[this.dataField],o=this.getInterestInvoker(e);t===this.Source.Hover||t===this.Source.Focus?((s=r.clearLostTask)==null||s.call(r),(c=(i=o==null?void 0:o[this.dataField])==null?void 0:i.clearLostTask)==null||c.call(i),this.scheduleInterestGainedTask(e,this.InterestState.FullInterest)):((d=r.clearGainedTask)==null||d.call(r),r.state!==this.InterestState.NoInterest&&this.scheduleInterestLostTask(e),o&&((f=(m=o[this.dataField])==null?void 0:m.clearGainedTask)==null||f.call(m),(t===this.Source.Blur||!e.matches(":hover"))&&this.scheduleInterestLostTask(o)))}handleUpstreamInterest(e,t){var r;let n=e.closest(".interest-target");if(n){let o=this.getInterestInvoker(n);if(o){let s=o[this.dataField];t===this.Source.Hover||t===this.Source.Focus?(r=s==null?void 0:s.clearLostTask)==null||r.call(s):(t===this.Source.Blur||!e.matches(":hover"))&&this.scheduleInterestLostTask(o)}}}gainOrLoseInterest(e,t,n){var r,o;if(!e||!t||!e.isConnected||this.getInterestForTarget(e)!==t||n===this.InterestState.NoInterest&&this.getInterestInvoker(t)!==e)return!1;if(n!==this.InterestState.NoInterest){let s=this.getInterestInvoker(t);if(s){if(s===e)return(o=(r=s[this.dataField])==null?void 0:r.clearLostTask)==null||o.call(r),!1;if(!this.gainOrLoseInterest(s,t,this.InterestState.NoInterest)||!e.isConnected||this.getInterestForTarget(e)!==t)return!1}return this.applyState(e,n)}return this.clearState(e),!0}applyState(e,t){let n=e[this.dataField],r=this.getInterestForTarget(e);if(!r)return!1;switch(t){case this.InterestState.FullInterest:if(n.state!==this.InterestState.NoInterest)throw new Error("Invalid state");let o=new CustomEvent(this.interestEventName,{bubbles:!0,cancelable:!0});Object.defineProperty(o,"source",{value:e,writable:!1}),r.dispatchEvent(o),e.dispatchEvent(new CustomEvent("interest:shown",{bubbles:!0,detail:{target:r,source:e}}));try{r.hasAttribute("popover")&&typeof r.showPopover=="function"&&(r.showPopover(),this.supportsAnchorPositioning()||requestAnimationFrame(()=>this.positionPopover(e,r)))}catch(s){}if(n.state=this.InterestState.FullInterest,r[this.targetDataField]||(r[this.targetDataField]={}),r[this.targetDataField].invoker=e,r.hasAttribute("popover")){let s=this.createPopoverToggleListener();r[this.targetDataField].toggleListener=s,r.addEventListener("toggle",s)}this.invokersWithInterest.add(e),e.classList.add("interest-source"),r.classList.add("interest-target"),this.isPlainHint(r)||e.setAttribute("aria-expanded","true"),this.setupAnchorPositioning(e,r,n);break;default:throw new Error("Invalid state")}return!0}clearState(e){let t=e[this.dataField];if(t&&(clearTimeout(t.gainedTimer),clearTimeout(t.lostTimer),t.state!==this.InterestState.NoInterest)){let n=this.getInterestForTarget(e);if(n){let r=new CustomEvent(this.loseInterestEventName,{bubbles:!0,cancelable:!0});Object.defineProperty(r,"source",{value:e,writable:!1}),n.dispatchEvent(r),e.dispatchEvent(new CustomEvent("interest:lost",{bubbles:!0,detail:{target:n,source:e}}));try{typeof n.hidePopover=="function"&&n.hidePopover()}catch(s){}let o=n[this.targetDataField];o!=null&&o.toggleListener&&n.removeEventListener("toggle",o.toggleListener),n[this.targetDataField]=null,this.invokersWithInterest.delete(e),e.classList.remove("interest-source"),n.classList.remove("interest-target"),this.isPlainHint(n)||e.setAttribute("aria-expanded","false"),this.cleanupAnchorPositioning(e,n,t)}t.state=this.InterestState.NoInterest}}supportsAnchorPositioning(){return"anchorName"in document.body.style}setupAnchorPositioning(e,t,n){let r=`--interest-anchor-${Math.random().toString(36).substring(2)}`;if(e.style.anchorName=r,t.style.positionAnchor=r,n.anchorName=r,this.supportsAnchorPositioning()){let o=`interest-anchored-${Math.random().toString(36).substring(2)}`,s=document.createElement("style");s.textContent=`
      .${o} {
        margin: 0;
        top: calc(anchor(${r} bottom) - 4px);
        left: anchor(${r});
        justify-self: center;
      }
    `,document.head.appendChild(s),t.classList.add(o),n.styleElement=s,n.className=o}}cleanupAnchorPositioning(e,t,n){n.anchorName&&(e.style.anchorName="",t.style.positionAnchor="",n.anchorName=null),n.styleElement&&(n.styleElement.remove(),n.styleElement=null),n.className&&(t.classList.remove(n.className),n.className=null),t.style.position="",t.style.top="",t.style.left="",t.style.zIndex=""}positionPopover(e,t){let n=e.getBoundingClientRect(),r=t.getBoundingClientRect(),o=window.innerWidth,s=window.innerHeight,i,c;c=n.left+n.width/2-r.width/2,i=n.bottom-4,i+r.height>s&&(i=n.top-r.height+4,i<0&&(i=n.bottom+8));let d=Math.max(8,Math.min(c,o-r.width-8)),m=Math.max(8,Math.min(i,s-r.height-8));t.style.position="fixed",t.style.top=`${m}px`,t.style.left=`${d}px`,t.style.zIndex="9999"}createPopoverToggleListener(){return e=>{let t=e.target;if(e.newState==="closed"){let r=t[this.targetDataField],o=r==null?void 0:r.invoker;o&&this.gainOrLoseInterest(o,t,this.InterestState.NoInterest)}}}scheduleInterestGainedTask(e,t){var o;let n=this.getDelaySeconds(e,this.interestDelayStartProp)*1e3;if(!isFinite(n)||n<0)return;let r=e[this.dataField];(o=r.clearGainedTask)==null||o.call(r),r.gainedTimer=setTimeout(()=>{this.gainOrLoseInterest(e,this.getInterestForTarget(e),t)},n)}scheduleInterestLostTask(e){var r;let t=this.getDelaySeconds(e,this.interestDelayEndProp)*1e3;if(!isFinite(t)||t<0)return;let n=e[this.dataField];(r=n.clearLostTask)==null||r.call(n),n.lostTimer=setTimeout(()=>{this.gainOrLoseInterest(e,this.getInterestForTarget(e),this.InterestState.NoInterest)},t)}getDelaySeconds(e,t){let n=getComputedStyle(e),r=n.getPropertyValue(t).trim();if(r.toLowerCase()!=="normal")return this.parseTimeValue(r);let o=n.getPropertyValue(this.interestDelayProp).trim();if(o&&o.toLowerCase()!=="normal"){let s=o.split(/\s+/).filter(i=>i.length>0);if(s.length>0){let i=s[0],c=s.length>1?s[1]:i,d=t===this.interestDelayStartProp?i:c;if(d.toLowerCase()!=="normal")return this.parseTimeValue(d)}}return t===this.interestDelayStartProp?.5:.25}parseTimeValue(e){let t=String(e).trim(),n=t.match(/^([\d.]+)s$/);if(n)return parseFloat(n[1]);let r=t.match(/^([\d.]+)ms$/);return r?parseFloat(r[1])/1e3:parseFloat(t)||0}initializeDataField(e){if(e[this.dataField])return;e[this.dataField]={state:this.InterestState.NoInterest,gainedTimer:null,lostTimer:null,longPressTimer:null,anchorName:null,clearGainedTask(){clearTimeout(this.gainedTimer)},clearLostTask(){clearTimeout(this.lostTimer)}};let t=this.getInterestForTarget(e);t&&this.setupAccessibility(e,t)}setupAccessibility(e,t){this.isPlainHint(t)?e.setAttribute("aria-describedby",t.id):(e.setAttribute("aria-details",t.id),e.setAttribute("aria-expanded","false"),t.hasAttribute("role")||t.setAttribute("role","tooltip"))}isPlainHint(e){var o,s;if(((o=e.getAttribute("popover"))==null?void 0:o.toLowerCase())!=="hint")return!1;let t=["a[href]","area[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","iframe","object","embed","[contenteditable]",'[tabindex]:not([tabindex="-1"])'].join(",");if(e.querySelector(t))return!1;let n=["h1","h2","h3","h4","h5","h6","ul","ol","li","table","nav","header","footer","main","aside","article","section","form","blockquote","details","summary","dialog"].join(",");if(e.querySelector(n))return!1;let r=e.querySelectorAll("[role]");for(let i of r){let c=(s=i.getAttribute("role"))==null?void 0:s.toLowerCase();if(c&&!["presentation","none","generic","image"].includes(c))return!1}return!0}getInterestForTarget(e){let t=e.getAttribute(this.attributeName);return t?document.getElementById(t):null}getInterestInvoker(e){var r;let t=e[this.targetDataField],n=(t==null?void 0:t.invoker)||null;return n&&((r=n[this.dataField])==null?void 0:r.state)!==this.InterestState.NoInterest?n:null}isInitialized(){return this.initialized}};D.instance=null;var ue=D;function Se(){let a=ue.getInstance();document.readyState==="complete"?a.apply():window.addEventListener("load",()=>a.apply())}Se();function Q(a){var r;let e=[],t="",n=0;for(;n<a.length;){let o=a[n];o==="\\"?(t+=(r=a[n+1])!=null?r:"",n+=2):o===":"?(e.push(t),t="",n++):(t+=o,n++)}return e.push(t),e}function pe(...a){return a.length>0&&!a[0].startsWith("--")&&(a[0]=`--${a[0]}`),a.map(e=>e.replace(/\\/g,"\\\\").replace(/:/g,"\\:")).join(":")}var A=!1;function l(a,e="error",t={}){let n=new Error(a);return n.severity=e,n.element=t.element,n.command=t.command,n.context=t.context,n.recovery=t.recovery,t.cause&&(n.cause=t.cause),n}function x(a,e="Invokers"){let t="severity"in a,n=t?a.severity:"error",r=n==="critical"||n==="error"?"error":"warn";if(A||n==="critical"){if(console.group(`${e}: ${a.message}`),console[r]("Error:",a),t){let o=a;o.element&&console.log("Element:",o.element),o.command&&console.log("Command:",o.command),o.context&&console.log("Context:",o.context),o.recovery&&console.log("Suggested fix:",o.recovery)}console.groupEnd()}else console[r](`${e}: ${a.message}`,t?a.element:void 0)}function M(a,e){let t=[];if(!a)return t.push("Element not found"),t;if(e.id&&!a.id&&t.push("Element missing required id attribute"),e.tagName&&!e.tagName.includes(a.tagName.toLowerCase())&&t.push(`Element must be one of: ${e.tagName.join(", ")}, got: ${a.tagName.toLowerCase()}`),e.attributes)for(let n of e.attributes)a.hasAttribute(n)||t.push(`Element missing required attribute: ${n}`);return t}function et(a){return a.map(e=>{if(typeof e!="string")return String(e);let t=e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/javascript:/gi,"").replace(/data:text\/html/gi,"").replace(/vbscript:/gi,"").replace(/on\w+\s*=/gi,"").replace(/expression\s*\(/gi,"");if(e.includes("://")||e.startsWith("//"))try{let n=new URL(e,window.location.href);if(!["http:","https:","ftp:","mailto:"].includes(n.protocol))return console.warn(`Invokers: Potentially unsafe URL protocol "${n.protocol}" detected and removed`),""}catch(n){return console.warn("Invokers: Malformed URL detected and removed:",e),""}return t})}function N(){return ee._interpolationEnabled}function me(a){if(!a||typeof a!="string")return"";let e=document.createElement("div");return e.innerHTML=a,e.querySelectorAll('script, object, embed, iframe, frame, meta, link[rel="import"]').forEach(r=>r.remove()),e.querySelectorAll("*").forEach(r=>{Array.from(r.attributes).forEach(o=>{(o.name.startsWith("on")||o.value.includes("javascript:")||o.value.includes("vbscript:")||o.value.includes("data:text/html"))&&r.removeAttribute(o.name)})}),e.innerHTML}var Le=(i=>(i.BEFORE_COMMAND="beforeCommand",i.AFTER_COMMAND="afterCommand",i.BEFORE_VALIDATION="beforeValidation",i.AFTER_VALIDATION="afterValidation",i.ON_SUCCESS="onSuccess",i.ON_ERROR="onError",i.ON_COMPLETE="onComplete",i))(Le||{}),Ae=new Set(["show-modal","close","request-close","show-popover","hide-popover","toggle-popover"]),he=class{constructor(){this.executionTimes=[];this.monitoringWindow=1e3}recordExecution(){let e=Date.now();return this.executionTimes=this.executionTimes.filter(t=>e-t<this.monitoringWindow),this.executionTimes.push(e),!0}getStats(){let e=Date.now(),t=this.executionTimes.filter(o=>e-o<this.monitoringWindow),n=t.slice(1).map((o,s)=>o-t[s]),r=n.length>0?n.reduce((o,s)=>o+s,0)/n.length:0;return{executionsLastSecond:t.length,averageInterval:r}}},L=class L{constructor(){this.commands=new Map;this.sortedCommandKeys=[];this.commandStates=new Map;this.performanceMonitor=new he;this.plugins=new Map;this.middleware=new Map;this.andThenManager=new ge(this),this.pipelineManager=new fe(this),typeof window!="undefined"&&typeof document!="undefined"?(this.registerCoreLibraryCommands(),this.registerExtendedCommands(),window.__invokerListenersAdded||(this.listen(),window.__invokerListenersAdded=!0),window.Invoker||(window.Invoker={register:this.register.bind(this),executeCommand:this.executeCommand.bind(this),registerPlugin:this.registerPlugin.bind(this),unregisterPlugin:this.unregisterPlugin.bind(this),registerMiddleware:this.registerMiddleware.bind(this),hasPlugin:this.hasPlugin.bind(this),getRegisteredPlugins:this.getRegisteredPlugins.bind(this),parseCommandString:Q,createCommandString:pe,instance:this,HookPoint:Le,reset:this.reset.bind(this)})):typeof global!="undefined"&&global.window&&global.document&&(this.registerCoreLibraryCommands(),this.registerExtendedCommands(),global.__invokerListenersAdded||(this.listen(),global.__invokerListenersAdded=!0))}static getInstance(){return L._instance||(L._instance=new L),L._instance}_enableInterpolation(){L._interpolationEnabled=!0}reset(){L._interpolationEnabled=!1,typeof window!="undefined"&&window.Invoker&&(window.Invoker.interpolateString=void 0,window.Invoker.generateUid=void 0,window.Invoker.getInterpolationUtility=void 0),console.log("Invokers: Reset complete.")}_tryInterpolate(e,t){var n;return L._interpolationEnabled&&typeof window!="undefined"&&((n=window.Invoker)!=null&&n.getInterpolationUtility)?window.Invoker.getInterpolationUtility()(e,t):e}async executeCommand(e,t,n){if(!this.performanceMonitor.recordExecution())return;if(!e||typeof e!="string"){let s=l("Command must be a non-empty string","error",{command:e,recovery:'Provide a valid command string like "--toggle" or "show-modal"'});x(s);return}if(!t||typeof t!="string"){let s=l("Target ID must be a non-empty string","error",{command:e,context:{targetId:t},recovery:"Provide a valid element ID that exists in the DOM"});x(s);return}let r=k(t,n||document.body);if(r.length===0){let s=Array.from(document.querySelectorAll("[id]")).map(d=>d.id).filter(Boolean),i=s.filter(d=>d.includes(t.toLowerCase())||t.includes(d.toLowerCase())),c=l(`Target element with selector "${t}" not found`,"error",{command:e,element:n,context:{targetId:t,availableIds:s.slice(0,10),suggestions:i.slice(0,3)},recovery:i.length>0?`Did you mean: ${i.slice(0,3).join(", ")}?`:"Check that the target element exists and has the correct selector"});x(c);return}let o=r[0];try{let s={command:e,source:n||null,target:o,preventDefault:()=>{},type:"command"};await this.executeCustomCommand(e,s)}catch(s){let i=l(`Failed to execute command "${e}" on element "${t}"`,"error",{command:e,element:n||o,cause:s,recovery:"Check the command syntax and ensure the target element supports this operation"});x(i)}}registerExtendedCommands(){for(let e in Z)Object.prototype.hasOwnProperty.call(Z,e)&&this.register(e,Z[e])}registerPlugin(e){if(this.plugins.has(e.name)){console.warn(`Invokers: Plugin "${e.name}" is already registered`);return}if(this.plugins.set(e.name,e),e.middleware)for(let[t,n]of Object.entries(e.middleware))n&&this.registerMiddleware(t,n);if(e.onRegister)try{e.onRegister(this)}catch(t){console.error(`Invokers: Error in plugin "${e.name}" onRegister:`,t)}A&&console.log(`Invokers: Plugin "${e.name}" registered successfully`)}unregisterPlugin(e){let t=this.plugins.get(e);if(!t){console.warn(`Invokers: Plugin "${e}" is not registered`);return}if(t.onUnregister)try{t.onUnregister(this)}catch(n){console.error(`Invokers: Error in plugin "${e}" onUnregister:`,n)}if(t.middleware)for(let n of Object.keys(t.middleware))this.unregisterMiddleware(n,t.middleware[n]);this.plugins.delete(e),A&&console.log(`Invokers: Plugin "${e}" unregistered successfully`)}registerMiddleware(e,t){this.middleware.has(e)||this.middleware.set(e,[]),this.middleware.get(e).push(t)}unregisterMiddleware(e,t){let n=this.middleware.get(e);if(n){let r=n.indexOf(t);r>-1&&n.splice(r,1)}}hasPlugin(e){return this.plugins.has(e)}getRegisteredPlugins(){return Array.from(this.plugins.keys())}async executeMiddleware(e,t,n=!1){let r=this.middleware.get(e);if(!(!r||r.length===0))for(let o of r)try{await Promise.resolve(o(t,e))}catch(s){if(n)throw s;console.error(`Invokers: Middleware error at ${e}:`,s)}}register(e,t){if(!e||typeof e!="string"){let o=l("Command name must be a non-empty string","error",{context:{name:e},recovery:'Provide a valid command name like "--my-command"'});x(o);return}if(!t||typeof t!="function"){let o=l(`Command callback for "${e}" must be a function`,"error",{command:e,context:{callback:t},recovery:"Provide a function that accepts a CommandContext parameter"});x(o);return}let n=e.trim();if(n.length===0){let o=l("Command name cannot be empty or whitespace only","error",{recovery:'Provide a meaningful command name like "--toggle" or "--fetch"'});x(o);return}let r=n;if(r.startsWith("--")||(r=`--${r}`,A&&console.warn(`Invokers: Command "${n}" registered without '--' prefix. Automatically registered as "${r}".`)),Ae.has(r.slice(2))){let o=l(`Cannot register custom command "${r}" - conflicts with native command "${r.slice(2)}"`,"error",{command:r,recovery:"Choose a different command name that doesn't conflict with native commands"});x(o);return}if(this.commands.has(r)){let o=l(`Command "${r}" is already registered and will be overwritten`,"warning",{command:r,recovery:"Use a different command name or ensure this overwrite is intentional"});x(o)}try{this.commands.set(r,t),this.sortedCommandKeys=Array.from(this.commands.keys()).sort((o,s)=>s.length-o.length),A&&console.log(`Invokers: Successfully registered command "${r}"`)}catch(o){let s=l(`Failed to register command "${r}"`,"critical",{command:r,cause:o,recovery:"Check that the callback function is valid and the command name is unique"});x(s)}}async handleCommand(e){let t=e.command;t.startsWith("--")?await this.executeCustomCommand(t,e):!Ae.has(t)&&t!==""&&(console.warn(`Invokers (Compatibility): Non-spec-compliant command "${t}" detected. Please update your HTML to use '--${t}' for future compatibility. Attempting to handle...`),await this.executeCustomCommand(`--${t}`,e))}async executeCustomCommand(e,t){var r,o;if(!e||typeof e!="string"){let s=l("Invalid command string provided","error",{command:e,element:t.source,recovery:"Ensure the command attribute contains a valid command string"});x(s);return}if(!this.performanceMonitor.recordExecution())return;let n=!1;for(let s of this.sortedCommandKeys)if(e.startsWith(s)&&(e.length===s.length||e[s.length]===":")){n=!0;let i=this.commands.get(s);if(!i){let c=l(`Command "${s}" is registered but callback is missing`,"critical",{command:e,element:t.source,recovery:"This is an internal error. Please report this issue."});x(c);return}try{t.preventDefault();let c={event:t.triggeringEvent,this:t.source,target:t.target,detail:(r=t.triggeringEvent)==null?void 0:r.detail},d=this._tryInterpolate(e,c),m=Q(d.substring(s.length+1)),f=et(m),u=this.createContext(t,d,f),h=t.source,w=u.getTargets();if(w.length===0){let y=l("No target elements found for command execution","warning",{command:e,element:h,recovery:"Ensure commandfor, aria-controls, or data-target points to valid elements"});x(y);return}for(let y of w){let p={...u,targetElement:y};await this.executeMiddleware("beforeCommand",p,!0),await this.executeMiddleware("beforeValidation",p,!0);let T=`${e}:${y.id}`,R=this.commandStates.get(T)||"active";if(h){let C=h.dataset.state||h.getAttribute("data-state");C&&(this.commandStates.has(T)&&this.commandStates.get(T)==="completed"||(R=C))}if(R==="disabled"||R==="completed")continue;let E={success:!0};try{let C=this.validateContext(p);if(C.length>0)throw l(`Command execution aborted: ${C.join(", ")}`,"error",{command:e,element:p.invoker||p.targetElement,context:{validationErrors:C},recovery:"Fix the validation errors and try again"});await this.executeMiddleware("afterValidation",p);let I=Promise.resolve(i(p)),b=new Promise((g,S)=>{setTimeout(()=>S(new Error("Command execution timeout")),3e4)});await Promise.race([I,b]),R==="once"&&this.commandStates.set(T,"completed"),await this.executeMiddleware("onSuccess",{...p,result:E}),A&&console.log(`Invokers: Command "${s}" executed successfully on target ${y.id||y}`)}catch(C){E={success:!1,error:C},await this.executeMiddleware("onError",{...p,result:E});let I=l(`Command "${s}" execution failed`,"error",{command:e,element:p.invoker||p.targetElement,cause:C,context:{params:p.params,targetId:(o=p.targetElement)==null?void 0:o.id,invokerState:R},recovery:this.generateRecoverySuggestion(s,C,p)});x(I),this.attemptGracefulDegradation(p,C)}await this.executeMiddleware("onComplete",{...p,result:E}),await this.executeMiddleware("afterCommand",{...p,result:E}),u.invoker&&y===w[0]&&(await this.andThenManager.processAndThen(u.invoker,E,y),await this.triggerFollowup(u.invoker,y,E))}}catch(c){if(c.message.includes("Validation failed")||c.message.includes("Plugin attempted to access"))throw c;let d=l(`Failed to execute command "${s}"`,"critical",{command:e,element:t.source,cause:c,recovery:"Check command syntax and ensure all required attributes are present"});x(d)}return}if(!n){let s=this.findSimilarCommands(e),i=l(`Unknown command "${e}"`,"error",{command:e,element:t.source,context:{availableCommands:this.sortedCommandKeys.slice(0,10),suggestions:s},recovery:s.length>0?`Did you mean: ${s.join(", ")}?`:`Check the command name and ensure it's registered. Custom commands must start with "--"`});x(i)}}validateContext(e){let t=[];return e.targetElement?e.targetElement.isConnected||t.push("Target element is not connected to the DOM"):t.push("Target element is null or undefined"),e.params.some(n=>n==null)&&t.push("Command contains null or undefined parameters"),t}generateRecoverySuggestion(e,t,n){let r=t.message.toLowerCase();return e.includes("fetch")?r.includes("network")||r.includes("fetch")?"Check your network connection and ensure the URL is correct and reachable":r.includes("cors")?"CORS error: Ensure your server allows cross-origin requests or use a proxy":"Verify the data-url attribute points to a valid endpoint that returns HTML":e.includes("media")?"Ensure the target element is a <video> or <audio> element":e.includes("form")?"Ensure the target element is a <form> element with a valid action attribute":e.includes("class")?"Check that the class name is valid and the target element exists":e.includes("attr")?"Verify the attribute name is valid and check data-attr-name/data-attr-value attributes":r.includes("null")||r.includes("undefined")?"Check that all required elements and attributes are present in the DOM":r.includes("permission")||r.includes("security")?"This operation requires user permission or HTTPS context":"Check the command syntax and ensure all required attributes are present"}attemptGracefulDegradation(e,t){try{e.invoker&&e.invoker.hasAttribute("aria-expanded")&&e.invoker.getAttribute("aria-expanded")===null&&e.invoker.setAttribute("aria-expanded","false"),e.invoker&&e.invoker.hasAttribute("disabled")&&setTimeout(()=>{e.invoker&&e.invoker.removeAttribute("disabled")},3e3),A&&console.log("Invokers: Attempted graceful degradation for failed command")}catch(n){console.warn("Invokers: Graceful degradation failed:",n)}}findSimilarCommands(e){let t=e.toLowerCase(),n=[];for(let r of this.sortedCommandKeys){let o=r.toLowerCase();if(t.includes(o.slice(2))){n.push(r);continue}this.levenshteinDistance(t,o)<=2&&n.push(r)}return n.slice(0,3)}levenshteinDistance(e,t){let n=Array(t.length+1).fill(null).map(()=>Array(e.length+1).fill(null));for(let r=0;r<=e.length;r++)n[0][r]=r;for(let r=0;r<=t.length;r++)n[r][0]=r;for(let r=1;r<=t.length;r++)for(let o=1;o<=e.length;o++){let s=e[o-1]===t[r-1]?0:1;n[r][o]=Math.min(n[r][o-1]+1,n[r-1][o]+1,n[r-1][o-1]+s)}return n[t.length][e.length]}async triggerFollowup(e,t,n){let r=this.getFollowupCommands(e,n);if(r.length!==0)for(let{command:o,target:s,state:i}of r){if(!s&&!t.id){console.warn("Invokers: A chained command requires the target element to have an ID.",t);continue}let c=s||t.id;c&&await this.scheduleCommand(o,c,i,t)}}getFollowupCommands(e,t){var o,s,i,c;if(!e)return[];let n=[],r=e.dataset.andThen||e.dataset.thenCommand;if(r){let d={event:e.triggeringEvent,this:e,target:null,detail:(o=e.triggeringEvent)==null?void 0:o.detail},m=this._tryInterpolate(r,d);n.push({command:m,target:e.dataset.thenTarget||e.dataset.target,state:e.dataset.state||"active"})}if(t){if(t.success&&e.dataset.afterSuccess){let d={event:e.triggeringEvent,this:e,target:null,detail:(s=e.triggeringEvent)==null?void 0:s.detail};e.dataset.afterSuccess.split(",").forEach(m=>{let f=this._tryInterpolate(m.trim(),d);n.push({command:f,target:e.dataset.thenTarget||e.dataset.target,state:e.dataset.state||"active"})})}if(!t.success&&e.dataset.afterError){let d={event:e.triggeringEvent,this:e,target:null,detail:(i=e.triggeringEvent)==null?void 0:i.detail};e.dataset.afterError.split(",").forEach(m=>{let f=this._tryInterpolate(m.trim(),d);n.push({command:f,target:e.dataset.thenTarget||e.dataset.target,state:e.dataset.state||"active"})})}if(e.dataset.afterComplete){let d={event:e.triggeringEvent,this:e,target:null,detail:(c=e.triggeringEvent)==null?void 0:c.detail};e.dataset.afterComplete.split(",").forEach(m=>{let f=this._tryInterpolate(m.trim(),d);n.push({command:f,target:e.dataset.thenTarget||e.dataset.target,state:e.dataset.state||"active"})})}}return n}createContext(e,t,n){let r=e.source,o=e.target,s=()=>{var y;if(!r){let p=i();return p?[p]:[]}let u=r.getAttribute("commandfor");if(u)return k(u,r);let h=(y=r.getAttribute("aria-controls"))==null?void 0:y.trim();if(h)return u="#"+h.split(/\s+/).join(", #"),k(u,r);let w=r.dataset.target;return w?k(w,r):o?[o]:[]},i=()=>o&&o.id?document.getElementById(o.id):o,c=u=>{if(!r)return;let h=u.some(w=>!w.hidden);r.setAttribute("aria-expanded",String(h)),r.hasAttribute("aria-pressed")&&r.setAttribute("aria-pressed",String(h))},d=()=>{if(!r)return;let u=s();if(u.length===0||!u[0].parentElement)return;let h=u[0].parentElement,w=new Set(Array.from(h.children).map(p=>p.id).filter(Boolean));Array.from(document.querySelectorAll("[commandfor], [aria-controls]")).filter(p=>{var R,E;return(p.getAttribute("commandfor")?[p.getAttribute("commandfor")]:[]).concat((E=(R=p.getAttribute("aria-controls"))==null?void 0:R.split(/\s+/))!=null?E:[]).some(C=>w.has(C))}).forEach(p=>{p!==r&&(p.setAttribute("aria-expanded","false"),p.hasAttribute("aria-pressed")&&p.setAttribute("aria-pressed","false"))})},m=(u,h,w="active")=>{r&&this.scheduleCommand(u,h||o.id,w,o)},f=u=>{r&&(u.onSuccess&&u.onSuccess.length>0&&(r.dataset.afterSuccess=u.onSuccess.join(",")),u.onError&&u.onError.length>0&&(r.dataset.afterError=u.onError.join(",")),u.onComplete&&u.onComplete.length>0&&(r.dataset.afterComplete=u.onComplete.join(",")))};return{invoker:r,targetElement:r?o:i()||o,fullCommand:t,params:n,triggeringEvent:e.triggeringEvent,getTargets:s,updateAriaState:c,manageGroupState:d,executeAfter:m,executeConditional:f}}listen(){document.addEventListener("command",e=>this.handleCommand(e),!0)}async scheduleCommand(e,t,n,r){let o=`${e}:${t}`;if(this.commandStates.get(o)==="disabled"||this.commandStates.get(o)==="completed")return;let s=document.getElementById(t)||(r&&t===r.id?r:null);if(s){let i={command:e,source:null,target:s,preventDefault:()=>{},type:"command"};await this.executeCustomCommand(e,i)}n==="once"?this.commandStates.set(o,"completed"):n==="completed"&&this.commandStates.set(o,"completed")}registerCoreLibraryCommands(){this.register("--toggle",async({getTargets:e,updateAriaState:t,invoker:n})=>{let r=e();if(r.length===0){let o=l("No target elements found for --toggle command","warning",{command:"--toggle",element:n,recovery:"Ensure commandfor points to a valid element id, or use aria-controls for multiple targets"});x(o);return}try{let o=()=>{r.forEach(s=>{if(!s.isConnected){console.warn("Invokers: Skipping disconnected target element",s);return}s.toggleAttribute("hidden")}),t(r)};await(document.startViewTransition?document.startViewTransition(o).finished:Promise.resolve(o()))}catch(o){throw l("Failed to toggle element visibility","error",{command:"--toggle",element:n,cause:o,recovery:"Check that target elements are valid DOM elements"})}}),this.register("--show",async({getTargets:e,updateAriaState:t,manageGroupState:n,invoker:r})=>{let o=e();if(o.length===0){let s=l("No target elements found for --show command","warning",{command:"--show",element:r,recovery:"Ensure commandfor points to a valid element id"});x(s);return}if(!o[0].parentElement){let s=l("Target element has no parent for --show command (cannot hide siblings)","warning",{command:"--show",element:o[0],recovery:"Use --toggle instead, or ensure the target element has siblings to manage"});x(s);return}try{let s=Array.from(o[0].parentElement.children),i=()=>{n(),s.forEach(c=>{c instanceof HTMLElement&&c.setAttribute("hidden","")}),o.forEach(c=>c.removeAttribute("hidden")),t(o)};await(document.startViewTransition?document.startViewTransition(i).finished:Promise.resolve(i()))}catch(s){throw l("Failed to show element and hide siblings","error",{command:"--show",element:r,cause:s,recovery:"Check that target elements and their siblings are valid DOM elements"})}}),this.register("--hide",({getTargets:e,updateAriaState:t})=>{let n=e();n.length!==0&&(n.forEach(r=>r.setAttribute("hidden","")),t(n))}),this.register("--class",({invoker:e,getTargets:t,params:n})=>{let[r,...o]=n,s=t();if(!r||s.length===0){console.warn('Invokers: `--class` command requires an action (e.g., "--class:toggle:my-class").',e);return}s.forEach(i=>{if(r==="ternary"){let[c,d,m]=o;if(!c||!d||!m){console.warn("Invokers: `--class:ternary` requires class-if-true, class-if-false, and condition.",e);return}let f=!1;m==="has-content"?f=!!(i.textContent&&i.textContent.trim()):m==="has-no-content"&&(f=!(i.textContent&&i.textContent.trim())),f?(i.classList.add(c),i.classList.remove(d)):(i.classList.remove(c),i.classList.add(d))}else if(r==="toggle"&&o[1]){let[c,d]=o;d==="has-content"?i.textContent&&i.textContent.trim()!==""?i.classList.add(c):i.classList.remove(c):d==="has-no-content"?i.textContent&&i.textContent.trim()!==""?i.classList.remove(c):i.classList.add(c):i.classList.toggle(c)}else{let c=o[0];if(!c&&r!=="clear"){console.warn("Invokers: `--class` command requires a class name.",e);return}switch(r){case"add":i.classList.add(c);break;case"remove":i.classList.remove(c);break;case"toggle":i.classList.toggle(c);break;case"clear":i.className="";break;default:console.warn(`Invokers: Unknown action "${r}" for '--class' command.`,e)}}})}),this.register("--text",({invoker:e,getTargets:t,params:n})=>{let[r,...o]=n,s=o.join(" "),i=t();if(!r)throw l("Text command requires an action (set, append, prepend, or clear)","error",{command:"--text",element:e,context:{params:n},recovery:"Use format: --text:set:Hello World or --text:append: more text"});if(i.length===0){let d=l("No target elements found for --text command","warning",{command:"--text",element:e,recovery:"Ensure commandfor points to a valid element id"});x(d);return}let c=["set","append","prepend","clear"];if(!c.includes(r))throw l(`Invalid text action "${r}". Must be one of: ${c.join(", ")}`,"error",{command:"--text",element:e,context:{action:r,validActions:c},recovery:"Use a valid action like: --text:set:Hello or --text:append: World"});try{i.forEach(d=>{if(!d.isConnected){console.warn("Invokers: Skipping disconnected target element",d);return}switch(r){case"set":d.textContent=s||"";break;case"append":d.textContent+=s||"";break;case"prepend":d.textContent=(s||"")+d.textContent;break;case"clear":d.textContent="";break}})}catch(d){throw l(`Failed to update text content with action "${r}"`,"error",{command:"--text",element:e,cause:d,context:{action:r,value:s},recovery:"Check that target elements support text content updates"})}}),this.register("--attr",({invoker:e,getTargets:t,params:n})=>{let[r,o,s]=n,i=t();if(!r)throw l("Attribute command requires an action (set, remove, or toggle)","error",{command:"--attr",element:e,context:{params:n},recovery:"Use format: --attr:set:disabled:true or --attr:remove:disabled"});if(!o)throw l("Attribute command requires an attribute name","error",{command:"--attr",element:e,context:{action:r,params:n},recovery:"Specify the attribute name: --attr:set:data-value:123"});if(i.length===0){let m=l("No target elements found for --attr command","warning",{command:"--attr",element:e,recovery:"Ensure commandfor points to a valid element id"});x(m);return}let c=["set","remove","toggle"];if(!c.includes(r))throw l(`Invalid attribute action "${r}". Must be one of: ${c.join(", ")}`,"error",{command:"--attr",element:e,context:{action:r,validActions:c},recovery:"Use a valid action like: --attr:set:disabled:true or --attr:toggle:hidden"});if(!/^[a-zA-Z][a-zA-Z0-9-]*$/.test(o))throw l(`Invalid attribute name "${o}". Attribute names must start with a letter and contain only letters, numbers, and hyphens`,"error",{command:"--attr",element:e,context:{attrName:o},recovery:'Use a valid HTML attribute name like "disabled" or "data-value"'});let d=s;if(N()&&s){let m={this:{...e,dataset:{...e.dataset},value:e.value||""},data:document.body.dataset,event:e.triggeringEvent};d=H(s,m)}try{i.forEach(m=>{if(!m.isConnected){console.warn("Invokers: Skipping disconnected target element",m);return}switch(r){case"set":m.setAttribute(o,d||"");break;case"remove":m.removeAttribute(o);break;case"toggle":m.hasAttribute(o)?m.removeAttribute(o):m.setAttribute(o,d||"");break}})}catch(m){throw l(`Failed to update attribute "${o}" with action "${r}"`,"error",{command:"--attr",element:e,cause:m,context:{action:r,attrName:o,attrValue:s},recovery:"Check that the attribute operation is valid for the target elements"})}}),this.register("--value",({invoker:e,getTargets:t,params:n})=>{let[r,...o]=n,s=t();if(s.length===0){let i=l("No target elements found for --value command","warning",{command:"--value",element:e,recovery:"Ensure commandfor points to a valid form input element"});x(i);return}try{s.forEach(i=>{if("value"in i){let c="";r==="clear"?c="":r==="set"&&o.length>0?c=o.join(":"):c=r||"",i.value=c}else console.warn("Invokers: --value command target does not support value property",i)})}catch(i){throw l("Failed to set value on target elements","error",{command:"--value",element:e,cause:i,recovery:"Ensure target elements are form inputs that support the value property"})}}),this.register("--focus",({invoker:e,getTargets:t})=>{let n=t();if(n.length===0){let r=l("No target elements found for --focus command","warning",{command:"--focus",element:e,recovery:"Ensure commandfor points to a focusable element"});x(r);return}try{typeof n[0].focus=="function"?n[0].focus():console.warn("Invokers: Target element does not support focus",n[0])}catch(r){throw l("Failed to focus target element","error",{command:"--focus",element:e,cause:r,recovery:"Ensure the target element is focusable and visible"})}}),this.register("--disabled",({invoker:e,getTargets:t,params:n})=>{let[r]=n,o=t();if(o.length===0){let s=l("No target elements found for --disabled command","warning",{command:"--disabled",element:e,recovery:"Ensure commandfor points to an element that supports the disabled property"});x(s);return}try{o.forEach(s=>{if("disabled"in s){let i=s;switch(r){case"toggle":i.disabled=!i.disabled;break;case"true":case"enable":i.disabled=!1;break;case"false":case"disable":i.disabled=!0;break;default:console.warn(`Invokers: Unknown action "${r}" for --disabled command. Use "toggle", "true", "false", "enable", or "disable".`)}}else console.warn("Invokers: --disabled command target does not support disabled property",s)})}catch(s){throw l("Failed to update disabled state on target elements","error",{command:"--disabled",element:e,cause:s,recovery:"Ensure target elements support the disabled property"})}}),this.register("--scroll",({invoker:e,getTargets:t,params:n})=>{let[r]=n,o=t();if(o.length===0){let s=l("No target elements found for --scroll command","warning",{command:"--scroll",element:e,recovery:"Ensure commandfor points to a valid element"});x(s);return}try{o.forEach(s=>{switch(r){case"into-view":s.scrollIntoView({behavior:"smooth",block:"start"});break;case"top":s.scrollIntoView({behavior:"smooth",block:"start"});break;case"bottom":s.scrollIntoView({behavior:"smooth",block:"end"});break;case"center":s.scrollIntoView({behavior:"smooth",block:"center"});break;default:console.warn(`Invokers: Unknown action "${r}" for --scroll command. Use "into-view", "top", "bottom", or "center".`),s.scrollIntoView({behavior:"smooth"})}})}catch(s){throw l("Failed to scroll target elements into view","error",{command:"--scroll",element:e,cause:s,recovery:"Ensure target elements are valid DOM elements"})}}),this.register("--storage",({invoker:e,getTargets:t,params:n})=>{var m,f,u;let[r,o,s,...i]=n,c=t();if(!r||!["local","session"].includes(r))throw l(`Invalid storage type "${r}". Must be "local" or "session"`,"error",{command:"--storage",element:e,context:{storageType:r,availableTypes:["local","session"]},recovery:"Use --storage:local:action:key or --storage:session:action:key"});let d=r==="local"?localStorage:sessionStorage;if(typeof Storage=="undefined")throw l("Web Storage API not supported in this browser","error",{command:"--storage",element:e,recovery:"Use a modern browser that supports localStorage/sessionStorage"});try{switch(o){case"set":if(!s)throw l("Storage set requires a key","error",{command:"--storage",element:e,recovery:"Use --storage:local:set:key:value or --storage:session:set:key:value"});let h=i.join(":");!h&&c.length>0&&"value"in c[0]&&(h=c[0].value);let w=((m=e==null?void 0:e.dataset)==null?void 0:m.storageJson)==="true"||h.startsWith("{")||h.startsWith("[");if(w)try{JSON.parse(h)}catch(b){h=JSON.stringify(h)}let y=(f=e==null?void 0:e.dataset)==null?void 0:f.storageExpires;if(y){let b=Date.now()+parseInt(y,10)*1e3,g={value:h,expiresAt:b,isJson:w};d.setItem(s,JSON.stringify(g))}else d.setItem(s,h);break;case"get":if(!s)throw l("Storage get requires a key","error",{command:"--storage",element:e,recovery:"Use --storage:local:get:key or --storage:session:get:key"});let p=d.getItem(s),T=p;if(p!==null)try{let b=JSON.parse(p);b&&typeof b=="object"&&"value"in b&&"expiresAt"in b&&(Date.now()>b.expiresAt?(d.removeItem(s),T=null):T=b.isJson?JSON.stringify(b.value):b.value)}catch(b){}c.length>0&&T!==null&&("value"in c[0]?c[0].value=T:c[0].textContent=T);break;case"remove":if(!s)throw l("Storage remove requires a key","error",{command:"--storage",element:e,recovery:"Use --storage:local:remove:key or --storage:session:remove:key"});d.removeItem(s),c.length>0&&("value"in c[0]?c[0].value="":c[0].textContent="Stored username will appear here");break;case"clear":d.clear(),c.length>0&&(c[0].textContent="Storage cleared successfully");break;case"keys":let R=s||"",E=Object.keys(d).filter(b=>b.startsWith(R));c.length>0&&(c[0].textContent=JSON.stringify(E));break;case"has":let C=d.getItem(s)!==null;c.length>0&&(c[0].textContent=C.toString());break;case"size":let I=0;for(let b=0;b<d.length;b++){let g=d.key(b);g&&(I+=g.length+(((u=d.getItem(g))==null?void 0:u.length)||0))}c.length>0&&(c[0].textContent=I.toString());break;default:throw l(`Unknown storage action "${o}"`,"error",{command:"--storage",element:e,context:{action:o,availableActions:["set","get","remove","clear","keys","has","size"]},recovery:"Use set, get, remove, clear, keys, has, or size actions"})}}catch(h){throw h instanceof Error&&h.name==="QuotaExceededError"?l("Storage quota exceeded. Cannot store more data.","error",{command:"--storage",element:e,cause:h,recovery:"Clear some storage space or use sessionStorage instead of localStorage"}):l(`Storage operation failed: ${h.message}`,"error",{command:"--storage",element:e,cause:h,recovery:"Check storage availability, quota limits, and data format"})}}),this.register("--animate",({invoker:e,getTargets:t,params:n})=>{var u,h,w,y;let[r,...o]=n,s=t();if(s.length===0){let p=l("No target elements found for --animate command","warning",{command:"--animate",element:e,recovery:"Ensure commandfor points to a valid element"});x(p);return}let i=["fade-in","fade-out","slide-up","slide-down","slide-left","slide-right","bounce","shake","pulse","flip","rotate-in","zoom-in","zoom-out","spin","wobble","jello","heartbeat","rubber-band"];if(!i.includes(r))throw l(`Unknown animation "${r}"`,"error",{command:"--animate",element:e,context:{animation:r,validAnimations:i},recovery:`Use one of: ${i.join(", ")}`});let c="0.5s",d="0s",m="ease-in-out",f="1";o.forEach(p=>{p.includes("duration:")?c=p.split(":")[1]||"0.5s":p.includes("delay:")?d=p.split(":")[1]||"0s":p.includes("easing:")?m=p.split(":")[1]||"ease-in-out":p.includes("iterations:")&&(f=p.split(":")[1]||"1")}),(u=e==null?void 0:e.dataset)!=null&&u.animateDuration&&(c=e.dataset.animateDuration),(h=e==null?void 0:e.dataset)!=null&&h.animateDelay&&(d=e.dataset.animateDelay),(w=e==null?void 0:e.dataset)!=null&&w.animateEasing&&(m=e.dataset.animateEasing),(y=e==null?void 0:e.dataset)!=null&&y.animateIterations&&(f=e.dataset.animateIterations);try{s.forEach(p=>{if(!p.isConnected){console.warn("Invokers: Skipping disconnected target element",p);return}p.classList.forEach(C=>{C.startsWith("invokers-animate-")&&p.classList.remove(C)}),p.style.animation="",p.offsetHeight;let T=`invokers-${r}`,R=`${T} ${c} ${m} ${d} ${f}`;p.style.animation=R;let E=C=>{C.animationName===T&&(p.style.animation="",p.removeEventListener("animationend",E))};p.addEventListener("animationend",E),setTimeout(()=>{p.style.animation.includes(T)&&(p.style.animation="",p.removeEventListener("animationend",E))},parseFloat(c)*1e3+parseFloat(d)*1e3+100)})}catch(p){throw l("Failed to animate target elements","error",{command:"--animate",element:e,cause:p,recovery:"Ensure target elements support CSS animations and check animation parameters"})}}),this.register("--url",({invoker:e,getTargets:t,params:n})=>{var d,m,f,u;let[r,...o]=n,s=t(),i=window.location,c=window.history;try{switch(r){case"params-get":if(o.length===0)throw l("URL params-get requires a parameter name","error",{command:"--url",element:e,recovery:"Use --url:params-get:param-name"});let h=o[0],w=i.search.startsWith("?")?i.search.substring(1):i.search,p=new URLSearchParams(w).get(h)||"";s.length>0&&("value"in s[0]?s[0].value=p:s[0].textContent=p);break;case"params-set":let T,R;if(o.length>=2){let[$e,...Fe]=o;T=$e,R=Fe.join(":")}else if(o.length===1)if(T=o[0],s.length>0&&"value"in s[0])R=s[0].value;else throw l("URL params-set with single parameter requires a target input element with a value","error",{command:"--url",element:e,recovery:"Use --url:params-set:param-name and commandfor pointing to an input element, or provide value: --url:params-set:param-name:value"});else if(o.length===0){if(T=((d=e==null?void 0:e.dataset)==null?void 0:d.urlParamName)||((m=e==null?void 0:e.dataset)==null?void 0:m.paramName)||"",!T)throw l("URL params-set without parameters requires data-url-param-name attribute","error",{command:"--url",element:e,recovery:'Add data-url-param-name="param-name" or use --url:params-set:param-name:value'});if(s.length>0&&"value"in s[0])R=s[0].value;else throw l("URL params-set without value parameter requires a target input element","error",{command:"--url",element:e,recovery:"Use commandfor pointing to an input element with the parameter value"})}else throw l("URL params-set requires parameter name and value","error",{command:"--url",element:e,recovery:"Use --url:params-set:param-name:value, or --url:params-set:param-name with commandfor to input element"});let E=new URL(i.href);E.searchParams.set(T,R);let C=((f=e==null?void 0:e.dataset)==null?void 0:f.urlPreserveState)==="true";c.replaceState(C?c.state:null,"",E.toString());break;case"params-delete":if(o.length===0)throw l("URL params-delete requires a parameter name","error",{command:"--url",element:e,recovery:"Use --url:params-delete:param-name"});let I=o[0],b=new URL(i.href);b.searchParams.delete(I),c.replaceState(null,"",b.toString());break;case"params-clear":let g=new URL(i.href);g.search="",c.replaceState(null,"",g.toString());break;case"params-all":let S=i.search.startsWith("?")?i.search.substring(1):i.search,$=Object.fromEntries(new URLSearchParams(S)),Me=JSON.stringify($);s.length>0&&(s[0].textContent=Me);break;case"hash-get":let ye=i.hash.substring(1);s.length>0&&("value"in s[0]?s[0].value=ye:s[0].textContent=ye);break;case"hash-set":let J;if(o.length>0)J=o.join(":");else if(s.length>0&&"value"in s[0])J=s[0].value;else throw l("URL hash-set without value requires a target input element with a value","error",{command:"--url",element:e,recovery:"Use --url:hash-set:hash-value or commandfor pointing to an input element"});i.hash=J?`#${J}`:"";break;case"hash-clear":i.hash="";break;case"pathname-get":let Oe=i.pathname;s.length>0&&(s[0].textContent=Oe);break;case"pathname-set":let ne;if(o.length>0)ne=o[0];else if(s.length>0&&"value"in s[0])ne=s[0].value;else throw l("URL pathname-set without value requires a target input element with a value","error",{command:"--url",element:e,recovery:"Use --url:pathname-set:/new-path or commandfor pointing to an input element"});let ve=new URL(i.href);ve.pathname=ne,c.replaceState(null,"",ve.toString());break;case"reload":let Ne=((u=e==null?void 0:e.dataset)==null?void 0:u.urlForceReload)==="true";i.reload(Ne);break;case"replace":if(o.length===0)throw l("URL replace requires a URL","error",{command:"--url",element:e,recovery:"Use --url:replace:new-url"});let Pe=o.join(":");c.replaceState(null,"",Pe);break;case"navigate":if(o.length===0)throw l("URL navigate requires a URL","error",{command:"--url",element:e,recovery:"Use --url:navigate:new-url"});let He=o.join(":");c.pushState({},"",He);break;case"base":let ke=`${i.protocol}//${i.host}`;s.length>0&&(s[0].textContent=ke);break;case"full":let De=i.href;s.length>0&&(s[0].textContent=De);break;default:throw l(`Unknown URL action "${r}"`,"error",{command:"--url",element:e,context:{action:r,availableActions:["params-get","params-set","params-delete","params-clear","params-all","hash-get","hash-set","hash-clear","pathname-get","pathname-set","reload","replace","navigate","base","full"]},recovery:"Use a valid URL action"})}}catch(h){throw l("URL operation failed","error",{command:"--url",element:e,cause:h,recovery:"Check URL format, parameter names, and browser support"})}}),this.register("--history",({invoker:e,getTargets:t,params:n})=>{let r=t(),o=n[0],s=n.slice(1);n[0]==="state"?n.length===1?(o="state:get",s=[]):(o=`${n[0]}:${n[1]}`,s=n.slice(2)):n.length>=2&&["length","clear"].includes(n[0])&&(o=`${n[0]}:${n[1]}`,s=n.slice(2));try{switch(o){case"push":if(s.length===0)throw l("History push requires a URL","error",{command:"--history",element:e,recovery:"Use --history:push:url or --history:push:url:title:state-data"});let i=s[0],c=s[1]||"",d=s.slice(2).join(":"),m=null;if(d)try{m=JSON.parse(d)}catch(I){m=d}window.history.pushState(m,c,i),r.length>0&&(r[0].textContent=`Pushed ${i} to history`);break;case"replace":if(s.length===0)throw l("History replace requires a URL","error",{command:"--history",element:e,recovery:"Use --history:replace:url or --history:replace:url:title:state-data"});let f=s[0],u=s[1]||"",h=s.slice(2).join(":"),w=null;if(h)try{w=JSON.parse(h)}catch(I){w=h}window.history.replaceState(w,u,f),r.length>0&&(r[0].textContent=`Replaced current URL with ${f}`);break;case"back":window.history.back(),r.length>0&&(r[0].textContent="Navigated back in history");break;case"forward":window.history.forward(),r.length>0&&(r[0].textContent="Navigated forward in history");break;case"go":let y=s[0]?parseInt(s[0],10):-1;if(isNaN(y))throw l("History go requires a valid number","error",{command:"--history",element:e,recovery:"Use --history:go:number (positive for forward, negative for back)"});window.history.go(y),r.length>0&&(r[0].textContent=`Navigated ${y>0?"forward":"back"} ${Math.abs(y)} page(s) in history`);break;case"state:get":let p=window.history.state,T=JSON.stringify(p);r.length>0&&(r[0].textContent=T);break;case"state:set":if(s.length===0)throw l("History state:set requires state data","error",{command:"--history",element:e,recovery:"Use --history:state:set:json-data"});let R=s.join(":"),E;try{E=JSON.parse(R)}catch(I){E=R}window.history.replaceState(E,document.title);break;case"length":let C=window.history.length;r.length>0&&(r[0].textContent=C.toString());break;case"clear":window.history.replaceState(null,document.title);break;default:throw l(`Unknown history action "${o}"`,"error",{command:"--history",element:e,context:{action:o,availableActions:["push","replace","back","forward","go","state","state:get","state:set","length","clear"]},recovery:"Use a valid history action"})}}catch(i){throw l("History operation failed","error",{command:"--history",element:e,cause:i,recovery:"Check browser history support and parameters"})}}),this.register("--device",async({invoker:e,getTargets:t,params:n})=>{var c,d,m,f,u,h;let[r,...o]=n,s=t(),i=async w=>{if("permissions"in navigator)try{return(await navigator.permissions.query({name:w})).state==="granted"}catch(y){return!1}return!0};try{switch(r){case"vibrate":if(o.length===0)throw l("Device vibrate requires a pattern","error",{command:"--device",element:e,recovery:"Use --device:vibrate:200 or --device:vibrate:100:200:100"});if(!("vibrate"in navigator)){console.warn("Invokers: Vibration API not supported");return}let w=o.map(g=>parseInt(g,10));navigator.vibrate(w.length===1?w[0]:w)||console.warn("Invokers: Vibration failed - may be blocked or not supported");break;case"share":if(!("share"in navigator)){console.warn("Invokers: Web Share API not supported");return}let p={};if(o.length>0)for(let g=0;g<o.length;g+=2){let S=o[g],$=o[g+1];S&&$!==void 0&&(S==="url"?p.url=$:S==="text"?p.text=$:S==="title"&&(p.title=$))}try{await navigator.share(p),document.dispatchEvent(new CustomEvent("device:share:success"))}catch(g){document.dispatchEvent(new CustomEvent("device:share:cancelled",{detail:g}))}break;case"geolocation:get":if(!("geolocation"in navigator))throw l("Geolocation API not supported","error",{command:"--device",element:e,recovery:"Geolocation requires HTTPS and user permission"});if(!await i("geolocation")){console.warn("Invokers: Geolocation permission not granted"),document.dispatchEvent(new CustomEvent("geolocation:denied"));return}let R={enableHighAccuracy:((c=e==null?void 0:e.dataset)==null?void 0:c.geoHighAccuracy)==="true",timeout:parseInt(((d=e==null?void 0:e.dataset)==null?void 0:d.geoTimeout)||"10000"),maximumAge:parseInt(((m=e==null?void 0:e.dataset)==null?void 0:m.geoMaxAge)||"0")};navigator.geolocation.getCurrentPosition(g=>{let S={latitude:g.coords.latitude,longitude:g.coords.longitude,accuracy:g.coords.accuracy,altitude:g.coords.altitude,altitudeAccuracy:g.coords.altitudeAccuracy,heading:g.coords.heading,speed:g.coords.speed,timestamp:g.timestamp};s.length>0&&(s[0].textContent=JSON.stringify(S)),document.dispatchEvent(new CustomEvent("device:geolocation:success",{detail:S}))},g=>{let S={code:g.code,message:g.message};document.dispatchEvent(new CustomEvent("device:geolocation:error",{detail:S}))},R);break;case"orientation:get":if(!window.DeviceOrientationEvent){console.warn("Invokers: Device Orientation API not supported");return}let E=((f=window.screen)==null?void 0:f.orientation)||window.orientation,C={angle:(E==null?void 0:E.angle)||0,type:(E==null?void 0:E.type)||"unknown"};s.length>0&&(s[0].textContent=JSON.stringify(C)),document.dispatchEvent(new CustomEvent("device:orientation:current",{detail:C}));break;case"motion:get":if(!window.DeviceMotionEvent){console.warn("Invokers: Device Motion API not supported");return}if(typeof DeviceMotionEvent.requestPermission=="function")try{if(await DeviceMotionEvent.requestPermission()!=="granted"){console.warn("Invokers: Device motion permission denied");return}}catch(g){console.warn("Invokers: Failed to request device motion permission");return}let I=!0;s.length>0&&(s[0].textContent=JSON.stringify({supported:I}));break;case"battery:get":if(!("getBattery"in navigator)){console.warn("Invokers: Battery API not supported");return}try{let g=await navigator.getBattery(),S={level:g.level,charging:g.charging,chargingTime:g.chargingTime,dischargingTime:g.dischargingTime};s.length>0&&(s[0].textContent=JSON.stringify(S)),document.dispatchEvent(new CustomEvent("device:battery:status",{detail:S}))}catch(g){console.warn("Invokers: Failed to get battery status",g)}break;case"clipboard:read":if(!((u=navigator.clipboard)!=null&&u.readText)){console.warn("Invokers: Clipboard read not supported");return}try{let g=await navigator.clipboard.readText();s.length>0&&("value"in s[0]?s[0].value=g:s[0].textContent=g),document.dispatchEvent(new CustomEvent("device:clipboard:read",{detail:g}))}catch(g){console.warn("Invokers: Clipboard read failed",g),document.dispatchEvent(new CustomEvent("device:clipboard:denied"))}break;case"clipboard:write":if(!((h=navigator.clipboard)!=null&&h.writeText)){console.warn("Invokers: Clipboard write not supported");return}let b=o.join(":");if(!b)throw l("Clipboard write requires text to copy","error",{command:"--device",element:e,recovery:"Use --device:clipboard:write:text-to-copy"});try{await navigator.clipboard.writeText(b),document.dispatchEvent(new CustomEvent("device:clipboard:written",{detail:b}))}catch(g){console.warn("Invokers: Clipboard write failed",g),document.dispatchEvent(new CustomEvent("device:clipboard:denied"))}break;case"wake-lock":if(!("wakeLock"in navigator)){console.warn("Invokers: Wake Lock API not supported");return}try{let g=await navigator.wakeLock.request("screen");window._invokersWakeLock=g,document.dispatchEvent(new CustomEvent("device:wake-lock:acquired"))}catch(g){console.warn("Invokers: Wake lock request failed",g),document.dispatchEvent(new CustomEvent("device:wake-lock:denied"))}break;case"wake-lock:release":window._invokersWakeLock&&(window._invokersWakeLock.release(),delete window._invokersWakeLock,document.dispatchEvent(new CustomEvent("device:wake-lock:released")));break;default:throw l(`Unknown device action "${r}"`,"error",{command:"--device",element:e,context:{action:r,availableActions:["vibrate","share","geolocation:get","orientation:get","motion:get","battery:get","clipboard:read","clipboard:write","wake-lock","wake-lock:release"]},recovery:"Use a supported device action"})}}catch(w){throw l("Device API operation failed","error",{command:"--device",element:e,cause:w,recovery:"Check device API support, permissions, and parameters"})}}),this.register("--a11y",({invoker:e,getTargets:t,params:n})=>{var c;let[r,...o]=n,s=o.join(":"),i=t();try{switch(r){case"announce":if(!s)throw l("A11y announce requires text to announce","error",{command:"--a11y",element:e,recovery:"Use --a11y:announce:Your announcement text"});let d=((c=e==null?void 0:e.dataset)==null?void 0:c.announcePriority)||"polite",m=document.getElementById(`invokers-a11y-announcer-${d}`);m||(m=document.createElement("div"),m.id=`invokers-a11y-announcer-${d}`,m.setAttribute("aria-live",d),m.setAttribute("aria-atomic","true"),m.style.position="absolute",m.style.left="-10000px",m.style.width="1px",m.style.height="1px",m.style.overflow="hidden",document.body.appendChild(m)),m.textContent="",setTimeout(()=>{m.textContent=s},100);break;case"focus":if(i.length===0)throw l("A11y focus requires target elements","error",{command:"--a11y",element:e,recovery:"Use commandfor to specify which element to focus"});let f=i[0];f.focus&&(f.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{f.focus(),document.dispatchEvent(new CustomEvent("a11y:focus:changed",{detail:{element:f,label:f.textContent||f.getAttribute("aria-label")}}))},300));break;case"skip-to":if(!s)throw l("A11y skip-to requires an element ID","error",{command:"--a11y",element:e,recovery:"Use --a11y:skip-to:element-id"});let u=document.getElementById(s);if(u)!u.hasAttribute("tabindex")&&!["button","input","select","textarea","a"].includes(u.tagName.toLowerCase())&&u.setAttribute("tabindex","-1"),u.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>{u.focus()},300);else throw l(`Element with id "${s}" not found`,"error",{command:"--a11y",element:e,recovery:"Ensure the target element exists and has the correct ID"});break;case"focus-trap":if(!s||!["enable","disable"].includes(s))throw l('A11y focus-trap requires "enable" or "disable"',"error",{command:"--a11y",element:e,recovery:"Use --a11y:focus-trap:enable or --a11y:focus-trap:disable"});if(s==="enable"&&i.length>0){let y=i[0],p=()=>y.querySelectorAll('button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])'),R=p()[0],E=I=>{let b=p(),g=b[0],S=b[b.length-1];I.key==="Tab"&&(I.shiftKey?document.activeElement===g&&(S.focus(),I.preventDefault()):document.activeElement===S&&(g.focus(),I.preventDefault())),I.key==="Escape"&&document.dispatchEvent(new CustomEvent("a11y:focus-trap:escape",{detail:{container:y}}))},C=I=>{let b=I.target;if(!y.contains(b)){let g=p();g.length>0&&g[0].focus()}};y.addEventListener("keydown",E),document.addEventListener("focusin",C),y._a11yFocusTrap={tabHandler:E,focusHandler:C},R==null||R.focus(),document.dispatchEvent(new CustomEvent("a11y:focus-trap:enabled",{detail:{container:y}}))}else if(s==="disable"&&i.length>0){let y=i[0],p=y._a11yFocusTrap;p&&(y.removeEventListener("keydown",p.tabHandler),document.removeEventListener("focusin",p.focusHandler),delete y._a11yFocusTrap),document.dispatchEvent(new CustomEvent("a11y:focus-trap:disabled",{detail:{container:y}}))}break;case"aria:set":if(!s||!s.includes(":"))throw l("A11y aria:set requires attribute:value format","error",{command:"--a11y",element:e,recovery:"Use --a11y:aria:set:attribute:value"});let[h,w]=s.split(":",2);i.length>0&&i.forEach(y=>{y.setAttribute(`aria-${h}`,w)});break;case"aria:remove":if(!s)throw l("A11y aria:remove requires an attribute name","error",{command:"--a11y",element:e,recovery:"Use --a11y:aria:remove:attribute"});i.length>0&&i.forEach(y=>{y.removeAttribute(`aria-${s}`)});break;case"heading-level":if(!s||!["1","2","3","4","5","6"].includes(s))throw l("A11y heading-level requires a level 1-6","error",{command:"--a11y",element:e,recovery:"Use --a11y:heading-level:1-6"});i.length>0&&i.forEach(y=>{var p;if(y.tagName.match(/^H[1-6]$/)){let T=`H${s}`,R=document.createElement(T);Array.from(y.attributes).forEach(E=>{R.setAttribute(E.name,E.value)}),R.innerHTML=y.innerHTML,(p=y.parentNode)==null||p.replaceChild(R,y)}else y.setAttribute("aria-level",s)});break;default:throw l(`Unknown accessibility action "${r}"`,"error",{command:"--a11y",element:e,context:{action:r,availableActions:["announce","focus","skip-to","focus-trap","aria:set","aria:remove","heading-level"]},recovery:"Use a valid accessibility action"})}}catch(d){throw l("Accessibility operation failed","error",{command:"--a11y",element:e,cause:d,recovery:"Check accessibility requirements and target elements"})}}),this.register("--pipeline",async({invoker:e,params:t})=>{let[n,r]=t;if(n!=="execute")throw l(`Invalid pipeline action "${n}". Only "execute" is supported`,"error",{command:"--pipeline",element:e,context:{action:n,availableActions:["execute"]},recovery:"Use --pipeline:execute:your-pipeline-id"});if(!r)throw l("Pipeline command requires a pipeline ID","error",{command:"--pipeline",element:e,context:{params:t},recovery:"Use --pipeline:execute:your-pipeline-id"});let o=this.createContext({command:"--pipeline:execute",source:e,target:e},"--pipeline:execute",t);await this.pipelineManager.executePipeline(r,o)})}registerPlugin(e){if(this.plugins.has(e.name))throw l(`Plugin "${e.name}" is already registered`,"error",{recovery:"Unregister the plugin first or use a different name"});if(this.plugins.set(e.name,e),e.middleware)for(let[t,n]of Object.entries(e.middleware))n&&this.registerMiddleware(t,n);e.onRegister&&e.onRegister()}unregisterPlugin(e){let t=this.plugins.get(e);if(!t)throw l(`Plugin "${e}" is not registered`,"error",{recovery:"Check the plugin name and ensure it is registered"});if(t.onUnregister&&t.onUnregister(),t.middleware)for(let[n,r]of Object.entries(t.middleware))r&&this.unregisterMiddleware(n,r);this.plugins.delete(e)}registerMiddleware(e,t){this.middleware.has(e)||this.middleware.set(e,[]),this.middleware.get(e).push(t)}unregisterMiddleware(e,t){let n=this.middleware.get(e);if(n){let r=n.indexOf(t);r>-1&&n.splice(r,1)}}async executeMiddleware(e,t){let n=this.middleware.get(e);if(n)for(let r of n)try{await r(t)}catch(o){x(l(`Middleware execution failed for hook "${e}"`,"error",{cause:o,recovery:"Check the middleware implementation for errors"}))}}};L._interpolationEnabled=!1;var ee=L,fe=class{constructor(e){this.invokerManager=e}async executePipeline(e,t){let n=document.getElementById(e);if(!(n!=null&&n.hasAttribute("data-pipeline"))){console.warn(`Invokers: Pipeline template "${e}" not found or not marked with data-pipeline attribute`);return}try{let r=this.parsePipelineSteps(n),o={success:!0};for(let s of r)if(this.shouldExecuteStep(s,o)&&(s.delay&&s.delay>0&&await new Promise(i=>setTimeout(i,s.delay)),o=await this.executeStep(s,t),s.once&&this.removeStepFromTemplate(n,s),!o.success&&!this.hasErrorHandler(r,r.indexOf(s)))){console.warn(`Invokers: Pipeline "${e}" stopped due to failed step: ${s.command}`);break}}catch(r){console.error(`Invokers: Pipeline "${e}" execution failed:`,r)}}parsePipelineSteps(e){let t=[];return e.content.querySelectorAll("pipeline-step").forEach((o,s)=>{let i=o.getAttribute("command"),c=o.getAttribute("target");if(!i||!c){console.warn(`Invokers: Pipeline step ${s} missing required command or target attribute`);return}let d={command:i,target:c,condition:o.getAttribute("condition")||"always",once:o.hasAttribute("once"),delay:parseInt(o.getAttribute("delay")||"0",10)},m={};Array.from(o.attributes).forEach(f=>{f.name.startsWith("data-")&&(m[f.name]=f.value)}),Object.keys(m).length>0&&(d.data=m),t.push(d)}),t}shouldExecuteStep(e,t){switch(e.condition){case"success":return t.success===!0;case"error":return t.success===!1;case"always":default:return!0}}async executeStep(e,t){try{let n=document.createElement("button");return n.setAttribute("type","button"),n.setAttribute("command",e.command.startsWith("--")?e.command:`--${e.command}`),n.setAttribute("commandfor",e.target),e.data&&Object.entries(e.data).forEach(([r,o])=>{n.setAttribute(r,o)}),await this.invokerManager.executeCommand(e.command,e.target,n),{success:!0}}catch(n){return{success:!1,error:n}}}hasErrorHandler(e,t){return e.slice(t+1).some(n=>n.condition==="error")}removeStepFromTemplate(e,t){e.content.querySelectorAll("pipeline-step").forEach(o=>{o.getAttribute("command")===t.command&&o.getAttribute("target")===t.target&&o.remove()})}},ge=class{constructor(e){this.invokerManager=e}async processAndThen(e,t,n){let r=Array.from(e.children).filter(o=>o.tagName.toLowerCase()==="and-then");for(let o of r)await this.executeAndThenRecursively(o,e,t,n)}async executeAndThenRecursively(e,t,n,r,o=0){if(o>25){x(l("Maximum <and-then> depth reached, stopping execution to prevent infinite loop.","critical",{element:e,recovery:"Check for circular or excessively deep <and-then> nesting."}));return}let s=e.dataset.state;if(s==="disabled"||s==="completed")return;let i=e.dataset.condition||"always";if(!this.shouldExecuteCondition(i,n))return;let c=e.getAttribute("command"),d=e.getAttribute("commandfor")||t.getAttribute("commandfor")||r.id,m=parseInt(e.dataset.delay||"0",10);if(!c||!d){x(l('<and-then> element is missing required "command" or "commandfor" attribute.',"warning",{element:e}));return}m>0&&await new Promise(h=>setTimeout(h,m));let f={success:!0};try{let h=this.createSyntheticInvoker(e,c,d);await this.invokerManager.executeCommand(c,d,h)}catch(h){f={success:!1,error:h}}e.hasAttribute("data-once")?e.remove():e.dataset.state="completed";let u=Array.from(e.children).filter(h=>h.tagName.toLowerCase()==="and-then");for(let h of u)await this.executeAndThenRecursively(h,t,f,r,o+1)}createSyntheticInvoker(e,t,n){let r=document.createElement("button");r.setAttribute("command",t.startsWith("--")?t:`--${t}`),r.setAttribute("commandfor",n);for(let o in e.dataset)r.dataset[o]=e.dataset[o];return r}shouldExecuteCondition(e,t){switch(e.toLowerCase()){case"success":return t.success===!0;case"error":return t.success===!1;case"always":return!0;default:return x(l(`Unknown condition for <and-then> element: "${e}"`,"warning")),!1}}},v=ee.getInstance(),tt=()=>{let a=null;typeof globalThis!="undefined"&&globalThis.window&&(a=globalThis.window),!a&&typeof global!="undefined"&&global.window&&(a=global.window),!a&&typeof window!="undefined"&&(a=window),a&&(a.Invoker={register:v.register.bind(v),executeCommand:v.executeCommand.bind(v),registerAll:v.registerExtendedCommands.bind(v),parseCommandString:Q,createCommandString:pe,instance:v,get debug(){return A},set debug(e){A=e,console.log(`Invokers: Debug mode ${e?"enabled":"disabled"}.`)},getStats:()=>v.performanceMonitor.getStats(),getRegisteredCommands:()=>Array.from(v.commands.keys()),validateElement:M,createError:l,logError:x,registerPlugin:v.registerPlugin.bind(v),unregisterPlugin:v.unregisterPlugin.bind(v),registerMiddleware:v.registerMiddleware.bind(v),unregisterMiddleware:v.unregisterMiddleware.bind(v),reset(){v.commands.clear(),v.commandStates.clear(),v.sortedCommandKeys=[],v.plugins.clear(),v.middleware.clear(),console.log("Invokers: Reset complete.")}}),typeof window!="undefined"&&!window.Invoker&&(window.Invoker=(a==null?void 0:a.Invoker)||{register:v.register.bind(v),executeCommand:v.executeCommand.bind(v),registerAll:v.registerExtendedCommands.bind(v),parseCommandString:Q,createCommandString:pe,instance:v,get debug(){return A},set debug(e){A=e,console.log(`Invokers: Debug mode ${e?"enabled":"disabled"}.`)},getStats:()=>v.performanceMonitor.getStats(),getRegisteredCommands:()=>Array.from(v.commands.keys()),validateElement:M,createError:l,logError:x,registerPlugin:v.registerPlugin.bind(v),unregisterPlugin:v.unregisterPlugin.bind(v),registerMiddleware:v.registerMiddleware.bind(v),unregisterMiddleware:v.unregisterMiddleware.bind(v),reset(){v.commands.clear(),v.commandStates.clear(),v.sortedCommandKeys=[],v.plugins.clear(),v.middleware.clear(),console.log("Invokers: Reset complete.")}})};tt();var te={"--demo:echo":({targetElement:a})=>{a.textContent=`Echo: ${new Date().toISOString()}`},"--demo:counter:increment":({invoker:a,targetElement:e})=>{let t=parseInt(a.dataset.maxCount||"100",10),n=parseInt(document.body.dataset.counter||"0",10);n<t&&(n++,document.body.dataset.counter=n.toString(),e.textContent=n.toString(),e.dispatchEvent(new CustomEvent("counter-updated",{bubbles:!0,detail:{count:n}})))},"--demo:counter:reset":({targetElement:a})=>{document.body.dataset.counter="0",a.textContent="0";let e=document.getElementById("progress-fill");e&&(e.style.width="0%")},"--demo:fetch:api":async({invoker:a,targetElement:e})=>{let t=a.dataset.url||"https://jsonplaceholder.typicode.com/posts/1";e.innerHTML='<div style="text-align: center; padding: 20px;"><div class="status-indicator status-loading pulse"></div>Loading...</div>';try{let n=await fetch(t);if(!n.ok)throw new Error(`HTTP ${n.status}`);let r=await n.json();e.innerHTML=`<pre>${JSON.stringify(r,null,2)}</pre>`}catch(n){let r=n instanceof Error?n.message:String(n);e.innerHTML=`<div style="color: #e53e3e; padding: 20px;"><div class="status-indicator status-error"></div>Error: ${r}</div>`}},"--demo:fetch:simulate-error":async({targetElement:a})=>{a.innerHTML='<div style="text-align: center; padding: 20px;"><div class="status-indicator status-loading pulse"></div>Loading...</div>',await new Promise(e=>setTimeout(e,1e3)),a.innerHTML='<div style="color: #e53e3e; padding: 20px;"><div class="status-indicator status-error"></div>Simulated network error</div>'},"--demo:chain:start":async({targetElement:a})=>{a.textContent=`Step 1: Starting chain...
`,await new Promise(e=>setTimeout(e,500)),a.textContent+=`Step 1: Completed
`},"--demo:event:publish":({invoker:a,targetElement:e})=>{let t=a.dataset.eventType||"demo-event",n=a.dataset.eventData?JSON.parse(a.dataset.eventData):{};e.textContent+=`Published event: ${t}
`,e.textContent+=`Data: ${JSON.stringify(n)}
`,document.dispatchEvent(new CustomEvent("demo-notification",{detail:{type:"info",title:"Event Published",message:`Event "${t}" was published successfully`}}))},"--demo:chart:add-point":({invoker:a,targetElement:e})=>{let t=a.dataset.valueFrom,n=Math.random()*100;if(t){let o=document.getElementById(t);o&&o.value&&(n=parseFloat(o.value)||n)}let r=window.demoChart;r&&(r.data.labels.push(new Date().toLocaleTimeString()),r.data.datasets[0].data.push(n),r.data.labels.length>10&&(r.data.labels.shift(),r.data.datasets[0].data.shift()),r.update()),e.textContent=`Added point: ${n.toFixed(2)}`},"--demo:chart:clear":({targetElement:a})=>{let e=window.demoChart;e&&(e.data.labels=[],e.data.datasets[0].data=[],e.update()),a.textContent="Chart cleared"},"--demo:api:github-user":async({invoker:a,targetElement:e})=>{let t=a.dataset.username||"octocat";e.innerHTML='<div style="text-align: center; padding: 20px;"><div class="status-indicator status-loading pulse"></div>Loading GitHub user...</div>';try{let n=await fetch(`https://api.github.com/users/${t}`);if(!n.ok)throw new Error(`GitHub API error: ${n.status}`);let r=await n.json();e.innerHTML=`
        <div style="text-align: center;">
          <img src="${r.avatar_url}" alt="${r.login}" style="width: 100px; height: 100px; border-radius: 50%;">
          <h3>${r.name||r.login}</h3>
          <p>${r.bio||"No bio available"}</p>
          <p>Followers: ${r.followers} | Following: ${r.following}</p>
          <p>Public repos: ${r.public_repos}</p>
        </div>
      `}catch(n){let r=n instanceof Error?n.message:String(n);e.innerHTML=`<div style="color: #e53e3e; padding: 20px;"><div class="status-indicator status-error"></div>Error loading GitHub user: ${r}</div>`}},"--demo:template:load-list":({targetElement:a})=>{let e=[{id:1,title:"Learn Invokers",completed:!0,priority:"high"},{id:2,title:"Build Amazing UI",completed:!1,priority:"medium"},{id:3,title:"Master JavaScript",completed:!1,priority:"low"}],t='<div style="max-height: 300px; overflow-y: auto;">';e.forEach(n=>{let r=n.completed?"completed":"";t+=`
        <div class="todo-item ${r}" style="padding: 10px; border-bottom: 1px solid #eee;">
          <strong>${n.title}</strong>
          <span style="float: right; color: ${n.priority==="high"?"#e53e3e":n.priority==="medium"?"#d69e2e":"#38a169"};">${n.priority}</span>
          ${n.completed?'<span style="color: #38a169;"></span>':""}
        </div>
      `}),t+="</div>",a.innerHTML=t},"--demo:condition:update":({invoker:a,targetElement:e})=>{let t=a.value,n="";switch(t){case"loading":n='<div style="text-align: center; padding: 20px;"><div class="status-indicator status-loading pulse"></div>Loading content...</div>';break;case"success":n='<div style="text-align: center; padding: 20px; color: #38a169;"><div class="status-indicator status-success"></div>Content loaded successfully!</div>';break;case"error":n='<div style="text-align: center; padding: 20px; color: #e53e3e;"><div class="status-indicator status-error"></div>Error loading content</div>';break}e.innerHTML=n},"--demo:programmatic":({targetElement:a})=>{a.textContent+=`Programmatic execution at ${new Date().toLocaleTimeString()}
`},"--demo:delayed":({targetElement:a})=>{a.textContent+=`Delayed execution completed at ${new Date().toLocaleTimeString()}
`},"--demo:queue:start":async({targetElement:a})=>{a.textContent=`Starting command queue...
`;let e=["Initializing...","Processing data...","Validating...","Completing..."];for(let t of e)a.textContent+=`${t}
`,await new Promise(n=>setTimeout(n,300));a.textContent+=`Queue execution completed!
`},"--demo:error:network":a=>{throw l("Network connection failed","error",{command:"--demo:error:network",recovery:"Check your internet connection and try again."})},"--demo:error:validation":a=>{throw l("Invalid input data provided","error",{command:"--demo:error:validation",recovery:"Please check your input and ensure all required fields are filled."})},"--demo:error:timeout":a=>{throw l("Operation timed out","error",{command:"--demo:error:timeout",recovery:"The operation took too long to complete. Please try again."})},"--demo:debug:toggle":({targetElement:a})=>{let t=!(document.body.dataset.debugMode==="true");document.body.dataset.debugMode=t.toString(),a.textContent=`Debug mode: ${t?"ENABLED":"DISABLED"}
`,a.textContent+=t?`Detailed command execution logs will be shown in console.
`:`Debug logging disabled.
`},"--demo:debug:execute":({targetElement:a})=>{let t={command:"--demo:debug:execute",timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href,debugMode:document.body.dataset.debugMode==="true"};a.innerHTML=`<pre>${JSON.stringify(t,null,2)}</pre>`},"--demo:clear":({targetElement:a})=>{a.textContent=""}};function nt(a){if(!window.Invoker){console.error("Invokers: Core library not found. Ensure it is loaded before the demo commands module.");return}let e=a||Object.keys(te);for(let t of e){let n=t.startsWith("--")?t:`--${t}`;te[n]?window.Invoker.register(n,te[n]):console.warn(`Invokers: Demo command "${t}" was requested but not found. Skipping registration.`)}}
/**
 * @file polyfill.ts
 * @summary A high-fidelity polyfill for the W3C/WHATWG HTML Invoker Buttons proposal.
 * @license MIT (Assumed from project context)
 * @author Keith Cirkel, Luke Warlow (original authors of explainer/polyfill)
 * @description This code implements the proposed `command` and `commandfor` attributes for HTMLButtonElement
 *              and the `CommandEvent` interface, allowing declarative UI interactions in browsers
 *              that do not yet natively support these features.
 *              It includes handling for popovers and dialogs, and a mechanism for custom commands.
 */
/**
 * @file interest-invokers.ts
 * @summary Interest Invokers polyfill and TypeScript support for the Invokers library
 * @description
 * This module provides comprehensive support for Interest Invokers as specified in:
 * https://open-ui.org/components/interest-invokers.explainer/
 * 
 * Based on the official polyfill by Mason Freed with TypeScript adaptation
 * and integration with the existing Invokers library patterns.
 * 
 * @author Mason Freed (original polyfill), Patrick Glenn (TypeScript adaptation)
 * @license MIT / BSD (compatible with original polyfill license)
 */
/**
 * @file index.ts
 * @version 1.1.0
 * @summary A lightweight, zero-dependency polyfill and superset for the upcoming native HTML Invoker Commands API.
 * @license MIT
 * @author Patrick Glenn
 * @see https://github.com/doeixd/invokers
 * @description
 * This library provides a robust polyfill for the W3C/WHATWG `command` attribute proposal
 * and extends it with a powerful set of custom commands (prefixed with `--`).
 * It features universal command chaining via the `data-and-then` attribute, allowing you
 * to create complex, declarative workflows in pure HTML.
 */
